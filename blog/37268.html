<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="Java technology blog.">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      hibernate框架技术 | Keis Note
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Keis Note</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>hibernate框架技术</h2>
  <p class="post-date">2018-01-11</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p><img src="http://ovi3ob9p4.bkt.clouddn.com/TIETU/CT0085.jpg" alt="image"></p>
<p>Hibernate是一个开放源代码的对象关系映射框架，它对JDBC进行了非常轻量级的对象封装，它将POJO与数据库表建立映射关系，是一个全自动的orm框架，hibernate可以自动生成SQL语句，自动执行，使得Java程序员可以随心所欲的使用对象编程思维来操纵数据库。 Hibernate可以应用在任何使用JDBC的场合，既可以在Java的客户端程序使用，也可以在Servlet/JSP的Web应用中使用，最具革命意义的是，Hibernate可以在应用EJB的J2EE架构中取代CMP，完成数据持久化的重任。<br><a id="more"></a></p>
<h1 id="hibernate框架的搭建"><a href="#hibernate框架的搭建" class="headerlink" title="hibernate框架的搭建"></a>hibernate框架的搭建</h1><h2 id="Hibernate框架的概述"><a href="#Hibernate框架的概述" class="headerlink" title="Hibernate框架的概述"></a>Hibernate框架的概述</h2><ol>
<li><p>Hibernate框架的概述</p>
<ul>
<li>Hibernate称为</li>
<li>Hibernate是一个开放源代码的对象关系映射（ORM）框架，它对JDBC进行了非常轻量级的对象封装，使得Java程序员可以随心所欲的使用对象编程思维来操纵数据库。 </li>
<li>Hibernate可以应用在任何使用JDBC的场合，既可以在Java的客户端程序使用，也可以在Servlet/JSP的Web应用中使用。</li>
<li>Hibernate是轻量级JavaEE应用的持久层解决方案，是一个关系数据库ORM框架</li>
</ul>
</li>
<li>记住：Hibernate是一个持久层的ORM框架！</li>
</ol>
<h2 id="什么是ORM（对象关系映射）"><a href="#什么是ORM（对象关系映射）" class="headerlink" title="什么是ORM（对象关系映射）"></a>什么是ORM（对象关系映射）</h2><ol>
<li><p>ORM映射：Object Relational Mapping</p>
<ul>
<li>O：面向对象领域的Object（JavaBean对象）</li>
<li>R：关系数据库领域的Relational（表的结构）</li>
<li>M：映射Mapping（XML的配置文件）</li>
</ul>
</li>
<li><p>简单一句话：Hibernate使程序员通过操作对象的方式来操作数据库表记录</p>
</li>
</ol>
<h1 id="Hibernate优点"><a href="#Hibernate优点" class="headerlink" title="Hibernate优点"></a>Hibernate优点</h1><ol>
<li><p>优点</p>
<ul>
<li>Hibernate对JDBC访问数据库的代码做了封装，大大简化了数据访问层繁琐的重复性代码</li>
<li>Hibernate是一个基于jdbc的主流持久化框架，是一个优秀的orm实现，它很大程度的简化了dao层编码工作</li>
<li>Hibernate的性能非常好，因为它是一个轻量级框架。映射的灵活性很出色。它支持很多关系型数据库，从一对一到多对多的各种复杂关系</li>
</ul>
</li>
</ol>
<h2 id="技术分析之Hibernate框架的快速入门"><a href="#技术分析之Hibernate框架的快速入门" class="headerlink" title="技术分析之Hibernate框架的快速入门"></a>技术分析之Hibernate框架的快速入门</h2><h3 id="第一步：下载Hibernate5的运行环境"><a href="#第一步：下载Hibernate5的运行环境" class="headerlink" title="第一步：下载Hibernate5的运行环境"></a>第一步：下载Hibernate5的运行环境</h3><ol>
<li><p>下载相应的jar包等</p>
<ul>
<li><a href="http://sourceforge.net/projects/hibernate/files/hibernate-orm/5.0.7.Final/hibernate-release-5.0.7.Final.zip/download" target="_blank" rel="noopener">http://sourceforge.net/projects/hibernate/files/hibernate-orm/5.0.7.Final/hibernate-release-5.0.7.Final.zip/download</a>  </li>
</ul>
</li>
<li><p>解压后对目录结构有一定的了解</p>
</li>
</ol>
<h3 id="第二步：创建表结构"><a href="#第二步：创建表结构" class="headerlink" title="第二步：创建表结构"></a>第二步：创建表结构</h3><ol>
<li>建表语句如下</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">database</span> hibernate_day01;</span><br><span class="line">    <span class="keyword">Use</span> hibernate_day01;</span><br><span class="line">    <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`cst_customer`</span> (</span><br><span class="line">      <span class="string">`cust_id`</span> <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'客户编号(主键)'</span>,</span><br><span class="line">      <span class="string">`cust_name`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户名称(公司名称)'</span>,</span><br><span class="line">      <span class="string">`cust_user_id`</span> <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'负责人id'</span>,</span><br><span class="line">      <span class="string">`cust_create_id`</span> <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建人id'</span>,</span><br><span class="line">      <span class="string">`cust_source`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户信息来源'</span>,</span><br><span class="line">      <span class="string">`cust_industry`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户所属行业'</span>,</span><br><span class="line">      <span class="string">`cust_level`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户级别'</span>,</span><br><span class="line">      <span class="string">`cust_linkman`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人'</span>,</span><br><span class="line">      <span class="string">`cust_phone`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'固定电话'</span>,</span><br><span class="line">      <span class="string">`cust_mobile`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'移动电话'</span>,</span><br><span class="line">      PRIMARY <span class="keyword">KEY</span> (<span class="string">`cust_id`</span>)</span><br><span class="line">    ) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">94</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<h3 id="第三步：搭建Hibernate的开发环境"><a href="#第三步：搭建Hibernate的开发环境" class="headerlink" title="第三步：搭建Hibernate的开发环境"></a>第三步：搭建Hibernate的开发环境</h3><ol>
<li><p>创建WEB工程，引入Hibernate开发所需要的jar包</p>
<ul>
<li>MySQL的驱动jar包</li>
<li>Hibernate开发需要的jar包（资料/hibernate-release-5.0.7.Final/lib/required/所有jar包）</li>
<li>日志jar包（资料/jar包/log4j/所有jar包）</li>
</ul>
</li>
</ol>
<h3 id="第四步：编写JavaBean实体类"><a href="#第四步：编写JavaBean实体类" class="headerlink" title="第四步：编写JavaBean实体类"></a>第四步：编写JavaBean实体类</h3><ol>
<li>Customer类的代码如下：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Long cust_id;</span><br><span class="line">        <span class="keyword">private</span> String cust_name;</span><br><span class="line">        <span class="keyword">private</span> Long cust_user_id;</span><br><span class="line">        <span class="keyword">private</span> Long cust_create_id;</span><br><span class="line">        <span class="keyword">private</span> String cust_source;</span><br><span class="line">        <span class="keyword">private</span> String cust_industry;</span><br><span class="line">        <span class="keyword">private</span> String cust_level;</span><br><span class="line">        <span class="keyword">private</span> String cust_linkman;</span><br><span class="line">        <span class="keyword">private</span> String cust_phone;</span><br><span class="line">        <span class="keyword">private</span> String cust_mobile;</span><br><span class="line">        <span class="comment">// 省略get和set方法</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="第五步：创建类与表结构的映射"><a href="#第五步：创建类与表结构的映射" class="headerlink" title="第五步：创建类与表结构的映射"></a>第五步：创建类与表结构的映射</h3><ol>
<li><p>在JavaBean所在的包下创建映射的配置文件</p>
<ul>
<li>默认的命名规则为：实体类名.hbm.xml</li>
<li>在xml配置文件中引入约束（引入的是hibernate3.0的dtd约束，不要引入4的约束）</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">            "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>如果不能上网，编写配置文件是没有提示的，需要自己来配置</p>
<ul>
<li>先复制<a href="http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd" target="_blank" rel="noopener">http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd</a> –&gt; window –&gt; preferences –&gt; 搜索xml –&gt; 选择xml catalog –&gt; 点击add –&gt; 现在URI –&gt; 粘贴复制的地址 –&gt; 选择location，选择本地的DTD的路径</li>
</ul>
</li>
<li><p>编写映射的配置文件</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.xujingyang.hibernate.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_user_id"</span> <span class="attr">column</span>=<span class="string">"cust_user_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_create_id"</span> <span class="attr">column</span>=<span class="string">"cust_create_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_linkman"</span> <span class="attr">column</span>=<span class="string">"cust_linkman  "</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="第六步：编写Hibernate核心的配置文件"><a href="#第六步：编写Hibernate核心的配置文件" class="headerlink" title="第六步：编写Hibernate核心的配置文件"></a>第六步：编写Hibernate核心的配置文件</h3><ol>
<li>在src目录下，创建名称为hibernate.cfg.xml的配置文件</li>
<li>在XML中引入DTD约束</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>打开：资料/hibernate-release-5.0.7.Final/project/etc/hibernate.properties，可以查看具体的配置信息 </p>
<ul>
<li><p>必须配置的4大参数 </p>
<p>  #hibernate.connection.driver_class com.mysql.jdbc.Driver<br>  #hibernate.connection.url jdbc:mysql:///test<br>  #hibernate.connection.username gavin<br>  #hibernate.connection.password</p>
</li>
<li><p>数据库的方言（必须配置的）<br>  #hibernate.dialect org.hibernate.dialect.MySQLDialect</p>
</li>
<li><p>可选的配置<br>  #hibernate.show_sql true<br>  #hibernate.format_sql true<br>  #hibernate.hbm2ddl.auto update</p>
</li>
<li><p>引入映射配置文件（一定要注意，要引入映射文件，框架需要加载映射文件）</p>
<ul>
<li><mapping resource="com/xujingyang/domain/Customer.hbm.xml">             
</mapping></li>
</ul>
</li>
</ul>
</li>
<li><p>具体的配置如下</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  * 必须配置的4大参数                    </span></span><br><span class="line"><span class="comment">            #hibernate.connection.driver_class com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">            #hibernate.connection.url jdbc:mysql:///test</span></span><br><span class="line"><span class="comment">            #hibernate.connection.username gavin</span></span><br><span class="line"><span class="comment">            #hibernate.connection.password</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate_day01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        * 数据库的方言（必须配置的）</span></span><br><span class="line"><span class="comment">            #hibernate.dialect org.hibernate.dialect.MySQLDialect</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        * 可选的配置</span></span><br><span class="line"><span class="comment">            #hibernate.show_sql true</span></span><br><span class="line"><span class="comment">            #hibernate.format_sql true</span></span><br><span class="line"><span class="comment">            #hibernate.hbm2ddl.auto update</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">         </span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- &lt;property name="hibernate.hbm2ddl.auto"&gt;update&lt;/property&gt; --&gt;</span></span><br><span class="line">         </span><br><span class="line">         <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        * 引入映射配置文件（一定要注意，要引入映射文件，框架需要加载映射文件）</span></span><br><span class="line"><span class="comment">            * &lt;mapping resource="com/itheima/domain/Customer.hbm.xml"/&gt;        </span></span><br><span class="line"><span class="comment">             --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/xujingyang/hibernate/Customer.hbm.xml"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="回忆：快速入门"><a href="#回忆：快速入门" class="headerlink" title="回忆：快速入门"></a>回忆：快速入门</h2><ol>
<li>下载Hibernate框架的开发包</li>
<li>编写数据库和表结构</li>
<li>创建WEB的项目，导入了开发的jar包<ul>
<li>MySQL驱动包、Hibernate开发的必须要有的jar包、日志的jar包</li>
</ul>
</li>
<li>编写JavaBean，以后不使用基本数据类型，使用包装类</li>
<li>编写映射的配置文件（核心），先导入开发的约束，里面正常配置标签</li>
<li>编写hibernate的核心的配置文件，里面的内容是固定的</li>
<li>编写代码，使用的类和方法</li>
</ol>
<h3 id="第七步：编写Hibernate入门代码"><a href="#第七步：编写Hibernate入门代码" class="headerlink" title="第七步：编写Hibernate入门代码"></a>第七步：编写Hibernate入门代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Query ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SQLQuery ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration ;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.hibernate.Customer ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.utils.HibernateUtil ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHibernate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddofUtils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        Customer c = <span class="keyword">new</span> Customer() ;</span><br><span class="line">        c.setCust_name(<span class="string">"hehe"</span>) ;</span><br><span class="line">        session.save(c) ;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">        session.close() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 加载配置文件</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration().configure() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建sessionFactory对象</span></span><br><span class="line">        SessionFactory sessionFactory = config.buildSessionFactory() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开启事物</span></span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编写操作代码</span></span><br><span class="line">        Customer c = <span class="keyword">new</span> Customer() ;</span><br><span class="line">        c.setCust_name(<span class="string">"小明"</span>) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 保存用户</span></span><br><span class="line">        session.save(c) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 提交事物</span></span><br><span class="line">        transaction.commit() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        session.close() ;</span><br><span class="line">        sessionFactory.close() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询数据,只能查询一条</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 加载配置文件</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration().configure() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建sessionFactory对象</span></span><br><span class="line">        SessionFactory sessionFactory = config.buildSessionFactory() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编写操作代码</span></span><br><span class="line">        Customer customer = session.get(Customer.class, <span class="number">94L</span>) ;</span><br><span class="line">        System.out.println(customer) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        session.close() ;</span><br><span class="line">        sessionFactory.close() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 加载配置文件</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration().configure() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建sessionFactory对象</span></span><br><span class="line">        SessionFactory sessionFactory = config.buildSessionFactory() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开启事物</span></span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编写操作代码</span></span><br><span class="line">        Customer c = session.get(Customer.class, <span class="number">94L</span>) ;</span><br><span class="line">        c.setCust_mobile(<span class="string">"12324343545"</span>) ;</span><br><span class="line">        session.update(c) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 提交事物</span></span><br><span class="line">        transaction.commit() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        session.close() ;</span><br><span class="line">        sessionFactory.close() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *更新或添加,存在就更新,不存在就添加 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSaveOrUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 加载配置文件</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration().configure() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建sessionFactory对象</span></span><br><span class="line">        SessionFactory sessionFactory = config.buildSessionFactory() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开启事物</span></span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编写操作代码</span></span><br><span class="line">        <span class="comment">// Customer c=session.get(Customer.class, 94L);</span></span><br><span class="line">        Customer c = <span class="keyword">new</span> Customer() ;</span><br><span class="line">        c.setCust_name(<span class="string">"小红2"</span>) ;</span><br><span class="line">        c.setCust_mobile(<span class="string">"22324343545"</span>) ;</span><br><span class="line">        session.saveOrUpdate(c) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 提交事物</span></span><br><span class="line">        transaction.commit() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        session.close() ;</span><br><span class="line">        sessionFactory.close() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 加载配置文件</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration().configure() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建sessionFactory对象</span></span><br><span class="line">        SessionFactory sessionFactory = config.buildSessionFactory() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开启事物</span></span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编写操作代码</span></span><br><span class="line">        Customer c = session.get(Customer.class, <span class="number">94L</span>) ;</span><br><span class="line">        session.delete(c) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 提交事物</span></span><br><span class="line">        transaction.commit() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        session.close() ;</span><br><span class="line">        sessionFactory.close() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询多条数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 加载配置文件</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration().configure() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建sessionFactory对象</span></span><br><span class="line">        SessionFactory sessionFactory = config.buildSessionFactory() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 按sql语句查找,并制定类型</span></span><br><span class="line">        SQLQuery sqlQuery = session.createSQLQuery(<span class="string">"select * from cst_customer"</span>).addEntity(</span><br><span class="line">                Customer.class) ;</span><br><span class="line">        </span><br><span class="line">        List&lt;Customer&gt; list = sqlQuery.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        session.close() ;</span><br><span class="line">        sessionFactory.close() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *所有数据 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetAllList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 加载配置文件</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration().configure() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建sessionFactory对象</span></span><br><span class="line">        SessionFactory sessionFactory = config.buildSessionFactory() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession() ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 按sql语句查找,并制定类型</span></span><br><span class="line">        Query query = session.createQuery(<span class="string">"from Customer"</span>) ;</span><br><span class="line">        </span><br><span class="line">        List&lt;Customer&gt; list = query.list() ;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Customer c=session.get(Customer.class, 94L);</span></span><br><span class="line">        Customer c = <span class="keyword">new</span> Customer() ;</span><br><span class="line">        c.setCust_name(<span class="string">"小红2"</span>) ;</span><br><span class="line">        c.setCust_mobile(<span class="string">"22324343545"</span>) ;</span><br><span class="line">        session.saveOrUpdate(c) ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        session.close() ;</span><br><span class="line">        sessionFactory.close() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第八步：编写Hibernate的SessionFactory工具类"><a href="#第八步：编写Hibernate的SessionFactory工具类" class="headerlink" title="第八步：编写Hibernate的SessionFactory工具类"></a>第八步：编写Hibernate的SessionFactory工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xujingyang.utils ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtil</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SessionFactory    sessionFactory    = <span class="keyword">null</span> ;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sessionFactory.openSession() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="技术分析之：Hibernate常用的配置文件"><a href="#技术分析之：Hibernate常用的配置文件" class="headerlink" title="技术分析之：Hibernate常用的配置文件"></a>技术分析之：Hibernate常用的配置文件</h2><h3 id="Hibernate配置文件之映射配置文件"><a href="#Hibernate配置文件之映射配置文件" class="headerlink" title="Hibernate配置文件之映射配置文件"></a>Hibernate配置文件之映射配置文件</h3><ol>
<li><p>映射文件，即Stu.hbm.xml的配置文件</p>
<ul>
<li><p><class>标签     – 用来将类与数据库表建立映射关系</class></p>
<ul>
<li>name          – 类的全路径</li>
<li>table         – 表名.(类名与表名一致,那么table属性也可以省略)</li>
<li>catalog       – 数据库的名称，基本上都会省略不写</li>
</ul>
</li>
<li><p><id>标签            – 用来将类中的属性与表中的主键建立映射，id标签就是用来配置主键的。</id></p>
<ul>
<li>name          – 类中属性名</li>
<li>column        – 表中的字段名.(如果类中的属性名与表中的字段名一致,那么column可以省略.)</li>
<li>length        – 字段的程度，如果数据库已经创建好了，那么length可以不写。如果没有创建好，生成表结构时，length最好指定。</li>
</ul>
</li>
<li><p><property>        – 用来将类中的普通属性与表中的字段建立映射.</property></p>
<ul>
<li>name          – 类中属性名</li>
<li>column        – 表中的字段名.(如果类中的属性名与表中的字段名一致,那么column可以省略.)</li>
<li>length        – 数据长度</li>
<li>type          – 数据类型（一般都不需要编写，如果写需要按着规则来编写）<ul>
<li>Hibernate的数据类型    type=”string”</li>
<li>Java的数据类型     type=”java.lang.String”</li>
<li>数据库字段的数据类型    <column name="name" sql-type="varchar"></column></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Hibernate配置文件之核心配置文件"><a href="#Hibernate配置文件之核心配置文件" class="headerlink" title="Hibernate配置文件之核心配置文件"></a>Hibernate配置文件之核心配置文件</h3><ol>
<li><p>核心配置文件的两种方式</p>
<ul>
<li><p>第一种方式是属性文件的形式，即properties的配置文件</p>
<ul>
<li>hibernate.properties<ul>
<li>hibernate.connection.driver_class=com.mysql.jdbc.Driver</li>
</ul>
</li>
<li>缺点<ul>
<li>不能加载映射的配置文件，需要手动编写代码去加载</li>
</ul>
</li>
</ul>
</li>
<li><p>第二种方式是XML文件的形式，开发基本都会选择这种方式</p>
<ul>
<li>hibernate.cfg.xml<ul>
<li><property name="hibernate.connection.driver_class">com.mysql.jdbc.Driver</property></li>
</ul>
</li>
<li>优点<ul>
<li>格式比较清晰</li>
<li>编写有提示</li>
<li>可以在该配置文件中加载映射的配置文件（最主要的）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>关于hibernate.cfg.xml的配置文件方式</p>
<ul>
<li><p>必须有的配置</p>
<ul>
<li><p>数据库连接信息:<br>  hibernate.connection.driver_class           – 连接数据库驱动程序<br>  hibernate.connection.url                    – 连接数据库URL<br>  hibernate.connection.username               – 数据库用户名<br>  hibernate.connection.password               – 数据库密码</p>
</li>
<li><p>方言:<br>  hibernate.dialect                           – 操作数据库方言</p>
</li>
</ul>
</li>
<li><p>可选的配置</p>
<ul>
<li>hibernate.show_sql                            – 显示SQL</li>
<li>hibernate.format_sql                          – 格式化SQL</li>
<li>hibernate.hbm2ddl.auto                        – 通过映射转成DDL语句<ul>
<li>create                – 每次都会创建一个新的表.—测试的时候</li>
<li>create-drop           – 每次都会创建一个新的表,当执行结束之后,将创建的这个表删除.—测试的时候</li>
<li>update                – 如果有表,使用原来的表.没有表,创建一个新的表.同时更新表结构.</li>
<li>validate              – 如果有表,使用原来的表.同时校验映射文件与表中字段是否一致如果不一致就会报错.</li>
</ul>
</li>
</ul>
</li>
<li><p>加载映射</p>
<ul>
<li>如果XML方式：<mapping resource="com/xujingyang/domain/User.hbm.xml"></mapping></li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="技术分析之Hibernate常用的接口和类"><a href="#技术分析之Hibernate常用的接口和类" class="headerlink" title="技术分析之Hibernate常用的接口和类"></a>技术分析之Hibernate常用的接口和类</h2><h3 id="Configuration类和作用"><a href="#Configuration类和作用" class="headerlink" title="Configuration类和作用"></a>Configuration类和作用</h3><ol>
<li><p>Configuration类</p>
<ul>
<li>Configuration对象用于配置并且启动Hibernate。</li>
<li><p>Hibernate应用通过该对象来获得对象-关系映射文件中的元数据，以及动态配置Hibernate的属性，然后创建SessionFactory对象。</p>
</li>
<li><p>简单一句话：加载Hibernate的配置文件，可以获取SessionFactory对象。</p>
</li>
</ul>
</li>
<li><p>Configuration类的其他应用（了解）</p>
<ul>
<li><p>加载配置文件的种类，Hibernate支持xml和properties类型的配置文件，在开发中基本都使用XML配置文件的方式。</p>
<ul>
<li><p>如果采用的是properties的配置文件，那么通过Configuration configuration = new Configuration();就可以假装配置文件</p>
<ul>
<li>但是需要自己手动加载映射文件</li>
<li>例如：config.addResource(“cn/itcast/domain/Student.hbm.xml”);</li>
</ul>
</li>
<li><p>如果采用的XML的配置文件，通过Configuration configuration = new Configuration().configure();加载配置文件</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="SessionFactory：重要"><a href="#SessionFactory：重要" class="headerlink" title="SessionFactory：重要"></a>SessionFactory：重要</h3><ol>
<li>是工厂类，是生成Session对象的工厂类</li>
<li><p>SessionFactory类的特点</p>
<ul>
<li>由Configuration通过加载配置文件创建该对象。</li>
<li><p>SessionFactory对象中保存了当前的数据库配置信息和所有映射关系以及预定义的SQL语句。同时，SessionFactory还负责维护Hibernate的二级缓存。</p>
<ul>
<li>预定义SQL语句<ul>
<li>使用Configuration类创建了SessionFactory对象是，已经在SessionFacotry对象中缓存了一些SQL语句</li>
<li>常见的SQL语句是增删改查（通过主键来查询）</li>
<li>这样做的目的是效率更高</li>
</ul>
</li>
</ul>
</li>
<li><p>一个SessionFactory实例对应一个数据库，应用从该对象中获得Session实例。</p>
</li>
<li>SessionFactory是线程安全的，意味着它的一个实例可以被应用的多个线程共享。</li>
<li>SessionFactory是重量级的，意味着不能随意创建或销毁它的实例。如果只访问一个数据库，只需要创建一个SessionFactory实例，且在应用初始化的时候完成。</li>
<li>SessionFactory需要一个较大的缓存，用来存放预定义的SQL语句及实体的映射信息。另外可以配置一个缓存插件，这个插件被称之为Hibernate的二级缓存，被多线程所共享</li>
</ul>
</li>
<li><p>总结</p>
<ul>
<li>一般应用使用一个SessionFactory,最好是应用启动时就完成初始化。</li>
</ul>
</li>
</ol>
<h3 id="Session接口"><a href="#Session接口" class="headerlink" title="Session接口"></a>Session接口</h3><ol>
<li><p>概述</p>
<ul>
<li>Session是在Hibernate中使用最频繁的接口。也被称之为持久化管理器。它提供了和持久化有关的操作，比如添加、修改、删除、加载和查询实体对象</li>
<li>Session 是应用程序与数据库之间交互操作的一个单线程对象，是 Hibernate 运作的中心</li>
<li>Session是线程不安全的</li>
<li>所有持久化对象必须在 session 的管理下才可以进行持久化操作</li>
<li>Session 对象有一个一级缓存，显式执行 flush 之前，所有的持久化操作的数据都缓存在 session 对象处</li>
<li>持久化类与 Session 关联起来后就具有了持久化的能力</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>不是线程安全的。应避免多个线程使用同一个Session实例</li>
<li>Session是轻量级的，它的创建和销毁不会消耗太多的资源。应为每次客户请求分配独立的Session实例</li>
<li>Session有一个缓存，被称之为Hibernate的一级缓存。每个Session实例都有自己的缓存</li>
</ul>
</li>
<li><p>常用的方法</p>
<ul>
<li>save(obj)</li>
<li>delete(obj)  </li>
<li>get(Class,id)</li>
<li>update(obj)</li>
<li>saveOrUpdate(obj)                 – 保存或者修改（如果没有数据，保存数据。如果有，修改数据）</li>
<li>createQuery()                     – HQL语句的查询的方式</li>
</ul>
</li>
</ol>
<h3 id="Transaction接口"><a href="#Transaction接口" class="headerlink" title="Transaction接口"></a>Transaction接口</h3><ol>
<li>Transaction是事务的接口</li>
<li><p>常用的方法</p>
<ul>
<li>commit()              – 提交事务</li>
<li>rollback()            – 回滚事务</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>Hibernate框架默认情况下事务不自动提交.需要手动提交事务</li>
<li>如果没有开启事务，那么每个Session的操作，都相当于一个独立的事务</li>
</ul>
</li>
</ol>
<h1 id="Hibernate特点"><a href="#Hibernate特点" class="headerlink" title="Hibernate特点"></a>Hibernate特点</h1><ol>
<li>Hibernate持久化对象的状态</li>
<li>Hibernate的一级缓存</li>
<li>Hibernate操作持久化对象的方法</li>
<li>Hibernate的基本查询</li>
</ol>
<h2 id="Hibernate的持久化类"><a href="#Hibernate的持久化类" class="headerlink" title="Hibernate的持久化类"></a>Hibernate的持久化类</h2><h3 id="什么是持久化类"><a href="#什么是持久化类" class="headerlink" title="什么是持久化类"></a>什么是持久化类</h3><ol>
<li><p>持久化类:就是一个Java类（咱们编写的JavaBean），这个Java类与表建立了映射关系就可以成为是持久化类。</p>
<ul>
<li>持久化类 = JavaBean + xxx.hbm.xml</li>
</ul>
</li>
</ol>
<h3 id="持久化类的编写规则"><a href="#持久化类的编写规则" class="headerlink" title="持久化类的编写规则"></a>持久化类的编写规则</h3><ol>
<li>提供一个无参数 public访问控制符的构造器              – 底层需要进行反射.</li>
<li>提供一个标识属性，映射数据表主键字段                   – 唯一标识OID.数据库中通过主键.Java对象通过地址确定对象.持久化类通过唯一标识OID确定记录</li>
<li>所有属性提供public访问控制符的 set或者get 方法</li>
<li>标识属性应尽量使用基本数据类型的包装类型</li>
</ol>
<h3 id="区分自然主键和代理主键"><a href="#区分自然主键和代理主键" class="headerlink" title="区分自然主键和代理主键"></a>区分自然主键和代理主键</h3><ol>
<li><p>创建表的时候</p>
<ul>
<li>自然主键:对象本身的一个属性.创建一个人员表,每个人都有一个身份证号.(唯一的)使用身份证号作为表的主键.自然主键.（开发中不会使用这种方式）</li>
<li>代理主键:不是对象本身的一个属性.创建一个人员表,为每个人员单独创建一个字段.用这个字段作为主键.代理主键.（开发中推荐使用这种方式）</li>
</ul>
</li>
<li><p>创建表的时候尽量使用代理主键创建表</p>
</li>
</ol>
<h3 id="主键的生成策略"><a href="#主键的生成策略" class="headerlink" title="主键的生成策略"></a>主键的生成策略</h3><ol>
<li><p>increment:适用于short,int,long作为主键.不是使用的数据库自动增长机制.</p>
<ul>
<li><p>Hibernate中提供的一种增长机制.</p>
<ul>
<li>先进行查询 :select max(id) from user;</li>
<li>再进行插入 :获得最大值+1作为新的记录的主键.</li>
</ul>
</li>
<li><p>问题:不能在集群环境下或者有并发访问的情况下使用.</p>
</li>
</ul>
</li>
<li><p>identity:适用于short,int,long作为主键。但是这个必须使用在有自动增长数据库中.采用的是数据库底层的自动增长机制.</p>
<ul>
<li>底层使用的是数据库的自动增长(auto_increment).像Oracle数据库没有自动增长.</li>
</ul>
</li>
<li><p>sequence:适用于short,int,long作为主键.底层使用的是序列的增长方式.</p>
<ul>
<li>Oracle数据库底层没有自动增长,想自动增长需要使用序列.</li>
</ul>
</li>
<li><p>uuid:适用于char,varchar类型的作为主键.</p>
<ul>
<li>使用随机的字符串作为主键.</li>
</ul>
</li>
<li><p>native:本地策略.根据底层的数据库不同,自动选择适用于该种数据库的生成策略.(short,int,long)</p>
<ul>
<li>如果底层使用的MySQL数据库:相当于identity.</li>
<li>如果底层使用Oracle数据库:相当于sequence.</li>
</ul>
</li>
<li><p>assigned:主键的生成不用Hibernate管理了.必须手动设置主键.   </p>
</li>
</ol>
<h2 id="Hibernate持久化对象的状态"><a href="#Hibernate持久化对象的状态" class="headerlink" title="Hibernate持久化对象的状态"></a>Hibernate持久化对象的状态</h2><h3 id="持久化对象的状态"><a href="#持久化对象的状态" class="headerlink" title="持久化对象的状态"></a>持久化对象的状态</h3><ol>
<li><p>Hibernate的持久化类</p>
<ul>
<li>持久化类:Java类与数据库的某个表建立了映射关系.这个类就称为是持久化类.<ul>
<li>持久化类 = Java类 + hbm的配置文件</li>
</ul>
</li>
</ul>
</li>
<li><p>Hibernate的持久化类的状态</p>
<ul>
<li><p>Hibernate为了管理持久化类：将持久化类分成了三个状态</p>
<ul>
<li><p>瞬时态:Transient  Object</p>
<ul>
<li>没有持久化标识OID, 没有被纳入到Session对象的管理.</li>
</ul>
</li>
<li><p>持久态:Persistent Object</p>
<ul>
<li>有持久化标识OID,已经被纳入到Session对象的管理.</li>
</ul>
</li>
<li><p>脱管态:Detached Object</p>
<ul>
<li>有持久化标识OID,没有被纳入到Session对象的管理.<h3 id="Hibernate持久化对象的状态的转换"><a href="#Hibernate持久化对象的状态的转换" class="headerlink" title="Hibernate持久化对象的状态的转换"></a>Hibernate持久化对象的状态的转换</h3></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>瞬时态  – 没有持久化标识OID, 没有被纳入到Session对象的管理</p>
<ul>
<li>获得瞬时态的对象<ul>
<li>User user = new User()</li>
</ul>
</li>
<li>瞬时态对象转换持久态<ul>
<li>save()/saveOrUpdate();</li>
</ul>
</li>
<li>瞬时态对象转换成脱管态<ul>
<li>user.setId(1)</li>
</ul>
</li>
</ul>
</li>
<li><p>持久态  – 有持久化标识OID,已经被纳入到Session对象的管理</p>
<ul>
<li>获得持久态的对象<ul>
<li>get()/load();</li>
</ul>
</li>
<li>持久态转换成瞬时态对象<ul>
<li>delete();  — 比较有争议的，进入特殊的状态(删除态:Hibernate中不建议使用的)</li>
</ul>
</li>
<li>持久态对象转成脱管态对象<ul>
<li>session的close()/evict()/clear();</li>
</ul>
</li>
</ul>
</li>
<li><p>脱管态  – 有持久化标识OID,没有被纳入到Session对象的管理</p>
<ul>
<li>获得托管态对象:不建议直接获得脱管态的对象.<ul>
<li>User user = new User();</li>
<li>user.setId(1);</li>
</ul>
</li>
<li>脱管态对象转换成持久态对象<ul>
<li>update();/saveOrUpdate()/lock();</li>
</ul>
</li>
<li>脱管态对象转换成瞬时态对象<ul>
<li>user.setId(null);</li>
</ul>
</li>
</ul>
</li>
<li><p>注意：持久态对象有自动更新数据库的能力!!!</p>
</li>
</ol>
<p><img src="http://ovi3ob9p4.bkt.clouddn.com/hibernate/hibernate001.jpg" alt="image"></p>
<h2 id="Hibernate的一级缓存"><a href="#Hibernate的一级缓存" class="headerlink" title="Hibernate的一级缓存"></a>Hibernate的一级缓存</h2><h3 id="Session对象的一级缓存（重点）"><a href="#Session对象的一级缓存（重点）" class="headerlink" title="Session对象的一级缓存（重点）"></a>Session对象的一级缓存（重点）</h3><ol>
<li><p>什么是缓存？</p>
<ul>
<li>其实就是一块内存空间,将数据源（数据库或者文件）中的数据存放到缓存中.再次获取的时候 ,直接从缓存中获取.可以提升程序的性能！</li>
</ul>
</li>
<li><p>Hibernate框架提供了两种缓存</p>
<ul>
<li>一级缓存  – 自带的不可卸载的.一级缓存的生命周期与session一致.一级缓存称为session级别的缓存.</li>
<li>二级缓存  – 默认没有开启，需要手动配置才可以使用的.二级缓存可以在多个session中共享数据,二级缓存称为是sessionFactory级别的缓存.</li>
</ul>
</li>
<li><p>Session对象的缓存概述</p>
<ul>
<li>Session接口中,有一系列的java的集合,这些java集合构成了Session级别的缓存(一级缓存).将对象存入到一级缓存中,session没有结束生命周期,那么对象在session中存放着</li>
<li>内存中包含Session实例 –&gt; Session的缓存（一些集合） –&gt; 集合中包含的是缓存对象！</li>
</ul>
</li>
<li><p>证明一级缓存的存在，编写查询的代码即可证明</p>
<ul>
<li>在同一个Session对象中两次查询，可以证明使用了缓存</li>
</ul>
</li>
<li><p>Hibernate框架是如何做到数据发生变化时进行同步操作的呢？</p>
<ul>
<li>使用get方法查询User对象</li>
<li>然后设置User对象的一个属性，注意：没有做update操作。发现，数据库中的记录也改变了。</li>
<li>利用快照机制来完成的（SnapShot）</li>
</ul>
</li>
</ol>
<p><img src="http://ovi3ob9p4.bkt.clouddn.com/hibernate/hibernate002.jpg" alt="image"></p>
<h3 id="控制Session的一级缓存（了解）"><a href="#控制Session的一级缓存（了解）" class="headerlink" title="控制Session的一级缓存（了解）"></a>控制Session的一级缓存（了解）</h3><ol>
<li><p>学习Session接口中与一级缓存相关的方法</p>
<ul>
<li>Session.clear()                       – 清空缓存。</li>
<li>Session.evict(Object entity)          – 从一级缓存中清除指定的实体对象。</li>
<li>Session.flush()                       – 刷出缓存<h3 id="Hibernate中的事务与并发"><a href="#Hibernate中的事务与并发" class="headerlink" title="Hibernate中的事务与并发"></a>Hibernate中的事务与并发</h3><h4 id="事务相关的概念"><a href="#事务相关的概念" class="headerlink" title="事务相关的概念"></a>事务相关的概念</h4></li>
</ul>
</li>
<li><p>什么是事务</p>
<ul>
<li>事务就是逻辑上的一组操作，组成事务的各个执行单元，操作要么全都成功，要么全都失败.</li>
<li>转账的例子：冠希给美美转钱，扣钱，加钱。两个操作组成了一个事情！</li>
</ul>
</li>
<li><p>事务的特性</p>
<ul>
<li>原子性   – 事务不可分割.</li>
<li>一致性   – 事务执行的前后数据的完整性保持一致.</li>
<li>隔离性   – 一个事务执行的过程中,不应该受到其他的事务的干扰.</li>
<li>持久性   – 事务一旦提交,数据就永久保持到数据库中.</li>
</ul>
</li>
<li><p>如果不考虑隔离性:引发一些读的问题</p>
<ul>
<li>脏读            – 一个事务读到了另一个事务未提交的数据.</li>
<li>不可重复读 – 一个事务读到了另一个事务已经提交的update数据,导致多次查询结果不一致.</li>
<li>虚读            – 一个事务读到了另一个事务已经提交的insert数据,导致多次查询结构不一致.</li>
</ul>
</li>
<li><p>通过设置数据库的隔离级别来解决上述读的问题</p>
<ul>
<li>未提交读:以上的读的问题都有可能发生.</li>
<li>已提交读:避免脏读,但是不可重复读，虚读都有可能发生.</li>
<li>可重复读:避免脏读，不可重复读.但是虚读是有可能发生.</li>
<li>串行化:以上读的情况都可以避免.</li>
</ul>
</li>
<li><p>如果想在Hibernate的框架中来设置隔离级别，需要在hibernate.cfg.xml的配置文件中通过标签来配置</p>
<ul>
<li>通过：hibernate.connection.isolation = 4 来配置</li>
<li>取值<ul>
<li>1—Read uncommitted isolation</li>
<li>2—Read committed isolation</li>
<li>4—Repeatable read isolation</li>
<li>8—Serializable isolation<h4 id="丢失更新的问题"><a href="#丢失更新的问题" class="headerlink" title="丢失更新的问题"></a>丢失更新的问题</h4></li>
</ul>
</li>
</ul>
</li>
<li><p>如果不考虑隔离性，也会产生写入数据的问题，这一类的问题叫丢失更新的问题。</p>
</li>
<li><p>例如：两个事务同时对某一条记录做修改，就会引发丢失更新的问题。</p>
<ul>
<li>A事务和B事务同时获取到一条数据，同时再做修改</li>
<li>如果A事务修改完成后，提交了事务</li>
<li>B事务修改完成后，不管是提交还是回滚，如果不做处理，都会对数据产生影响</li>
</ul>
</li>
<li><p>解决方案有两种</p>
<ul>
<li><p>悲观锁</p>
<ul>
<li>采用的是数据库提供的一种锁机制，如果采用做了这种机制，在SQL语句的后面添加 for update 子句<ul>
<li>当A事务在操作该条记录时，会把该条记录锁起来，其他事务是不能操作这条记录的。</li>
<li>只有当A事务提交后，锁释放了，其他事务才能操作该条记录</li>
</ul>
</li>
</ul>
</li>
<li><p>乐观锁</p>
<ul>
<li>采用版本号的机制来解决的。会给表结构添加一个字段version=0，默认值是0<ul>
<li>当A事务在操作完该条记录，提交事务时，会先检查版本号，如果发生版本号的值相同时，才可以提交事务。同时会更新版本号version=1.</li>
<li>当B事务操作完该条记录时，提交事务时，会先检查版本号，如果发现版本不同时，程序会出现错误。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>使用Hibernate框架解决丢失更新的问题</p>
<ul>
<li><p>悲观锁</p>
<ul>
<li>使用session.get(Customer.class, 1,LockMode.UPGRADE); 方法</li>
</ul>
</li>
<li><p>乐观锁</p>
<ul>
<li>1.在对应的JavaBean中添加一个属性，名称可以是任意的。例如：private Integer version; 提供get和set方法</li>
<li>2.在映射的配置文件中，提供<version name="version">标签即可。</version></li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="http://ovi3ob9p4.bkt.clouddn.com/hibernate/hibernate003.jpg" alt="image"></p>
<h4 id="绑定本地的Session"><a href="#绑定本地的Session" class="headerlink" title="绑定本地的Session"></a>绑定本地的Session</h4><ol>
<li><p>之前在讲JavaWEB的事务的时候，需要在业务层使用Connection来开启事务，</p>
<ul>
<li>一种是通过参数的方式传递下去</li>
<li>另一种是把Connection绑定到ThreadLocal对象中</li>
</ul>
</li>
<li><p>现在的Hibernate框架中，使用session对象开启事务，所以需要来传递session对象，框架提供了ThreadLocal的方式</p>
<ul>
<li>需要在hibernate.cfg.xml的配置文件中提供配置</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=&quot;hibernate.current_session_context_class&quot;&gt;thread&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<pre><code>* 重新HibernateUtil的工具类，使用SessionFactory的getCurrentSession()方法，获取当前的Session对象。并且该Session对象不用手动关闭，线程结束了，会自动关闭。
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static Session getCurrentSession()&#123;</span><br><span class="line">            return factory.getCurrentSession();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<pre><code>* 注意：想使用getCurrentSession()方法，必须要先配置才能使用。
</code></pre><h3 id="Hibernate框架的查询方式"><a href="#Hibernate框架的查询方式" class="headerlink" title="Hibernate框架的查询方式"></a>Hibernate框架的查询方式</h3><h4 id="Query查询接口"><a href="#Query查询接口" class="headerlink" title="Query查询接口"></a>Query查询接口</h4><ol>
<li>具体的查询代码如下</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.查询所有记录</span></span><br><span class="line">    Query query = session.createQuery(<span class="string">"from Customer"</span>);</span><br><span class="line">    List&lt;Customer&gt; list = query.list();</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.条件查询:</span></span><br><span class="line">    Query query = session.createQuery(<span class="string">"from Customer where name = ?"</span>);</span><br><span class="line">    query.setString(<span class="number">0</span>, <span class="string">"李健"</span>);</span><br><span class="line">    List&lt;Customer&gt; list = query.list();</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.条件查询:</span></span><br><span class="line">    Query query = session.createQuery(<span class="string">"from Customer where name = :aaa and age = :bbb"</span>);</span><br><span class="line">    query.setString(<span class="string">"aaa"</span>, <span class="string">"李健"</span>);</span><br><span class="line">    query.setInteger(<span class="string">"bbb"</span>, <span class="number">38</span>);</span><br><span class="line">    List&lt;Customer&gt; list = query.list();</span><br><span class="line">    System.out.println(list);</span><br></pre></td></tr></table></figure>
<h4 id="Criteria查询接口（做条件查询非常合适）"><a href="#Criteria查询接口（做条件查询非常合适）" class="headerlink" title="Criteria查询接口（做条件查询非常合适）"></a>Criteria查询接口（做条件查询非常合适）</h4><ol>
<li>具体的查询代码如下</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.查询所有记录</span></span><br><span class="line">    Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">    List&lt;Customer&gt; list = criteria.list();</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.条件查询</span></span><br><span class="line">    Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">    criteria.add(Restrictions.eq(<span class="string">"name"</span>, <span class="string">"李健"</span>));</span><br><span class="line">    List&lt;Customer&gt; list = criteria.list();</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.条件查询</span></span><br><span class="line">    Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">    criteria.add(Restrictions.eq(<span class="string">"name"</span>, <span class="string">"李健"</span>));</span><br><span class="line">    criteria.add(Restrictions.eq(<span class="string">"age"</span>, <span class="number">38</span>));</span><br><span class="line">    List&lt;Customer&gt; list = criteria.list();</span><br><span class="line">    System.out.println(list);</span><br></pre></td></tr></table></figure>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xujingyang.hibernate ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Criteria ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Query ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Criterion ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions ;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.domain.User ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.utils.HibernateUtil ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        User user = session.get(User.class, <span class="number">1</span>) ;</span><br><span class="line">        user.setName(<span class="string">"小明"</span>) ;</span><br><span class="line">        user.setAge(<span class="number">18</span>) ;</span><br><span class="line">        session.update(user) ;</span><br><span class="line">        <span class="comment">// session.clear();//清除缓存</span></span><br><span class="line">        <span class="comment">// session.evict(user);//从一级缓存中删除指定的对象</span></span><br><span class="line">        <span class="comment">// session.flush();//输出缓存</span></span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        User user = session.get(User.class, <span class="number">1</span>) ;</span><br><span class="line">        user.setName(<span class="string">"小明"</span>) ;</span><br><span class="line">        user.setAge(<span class="number">11</span>) ;</span><br><span class="line">        session.update(user) ;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        User user = session.get(User.class, <span class="number">1</span>) ;</span><br><span class="line">        user.setName(<span class="string">"小明"</span>) ;</span><br><span class="line">        user.setMoney(<span class="number">12</span>) ;</span><br><span class="line">        session.update(user) ;</span><br><span class="line">        </span><br><span class="line">        User u = <span class="keyword">new</span> User() ;</span><br><span class="line">        u.setName(<span class="string">"小红"</span>) ;</span><br><span class="line">        u.setMoney(<span class="number">12</span>) ;</span><br><span class="line">        session.saveOrUpdate(u) ;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 演示事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = <span class="keyword">null</span> ;</span><br><span class="line">        Transaction transaction = <span class="keyword">null</span> ;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            session = HibernateUtil.getThreadLocalSession() ;</span><br><span class="line">            transaction = session.beginTransaction() ;</span><br><span class="line">            add1() ;</span><br><span class="line">            <span class="comment">// int i = 1 / 0 ;</span></span><br><span class="line">            add2() ;</span><br><span class="line">            transaction.commit() ;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace() ;</span><br><span class="line">            transaction.rollback() ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getThreadLocalSession() ;</span><br><span class="line">        User user = session.get(User.class, <span class="number">1</span>) ;</span><br><span class="line">        user.setMoney(<span class="number">0</span>) ;</span><br><span class="line">        session.update(user) ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getThreadLocalSession() ;</span><br><span class="line">        User u = session.get(User.class, <span class="number">2</span>) ;</span><br><span class="line">        u.setName(<span class="string">"小红"</span>) ;</span><br><span class="line">        u.setMoney(<span class="number">24</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HQL按条件查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Query query = session.createQuery(<span class="string">"from User where name=?"</span>) ;</span><br><span class="line">        query.setString(<span class="number">0</span>, <span class="string">"小明"</span>) ;</span><br><span class="line">        List list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.out.println(object) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HQL按条件查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Query query = session.createQuery(<span class="string">"from User where name=:name"</span>) ;</span><br><span class="line">        query.setString(<span class="string">"name"</span>, <span class="string">"小明"</span>) ;</span><br><span class="line">        List list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.out.println(object) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Criteria criteria = session.createCriteria(User.class) ;</span><br><span class="line">        List list = criteria.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.out.println(object) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Criteria criteria = session.createCriteria(User.class) ;</span><br><span class="line">        criteria.add(Restrictions.gt(<span class="string">"money"</span>, <span class="number">0</span>)) ;</span><br><span class="line">        List list = criteria.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.out.println(object) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="hibernate之关联关系映射"><a href="#hibernate之关联关系映射" class="headerlink" title="hibernate之关联关系映射"></a>hibernate之关联关系映射</h1><h2 id="案例：完成CRM的联系人的保存操作"><a href="#案例：完成CRM的联系人的保存操作" class="headerlink" title="案例：完成CRM的联系人的保存操作"></a>案例：完成CRM的联系人的保存操作</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><ol>
<li>因为客户和联系人是一对多的关系，在有客户的情况下，完成联系人的添加保存操作<br>技术分析之Hibernate的关联关系映射之一对多映射（重点）</li>
</ol>
<h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><ol>
<li><p>JavaWEB中一对多的设计及其建表原则</p>
</li>
<li><p>先导入SQL的建表语句</p>
<ul>
<li>创建数据库：create database hibernate_03;</li>
</ul>
</li>
<li><p>编写客户和联系人的JavaBean程序（注意一对多的编写规则）</p>
<ul>
<li>客户的JavaBean如下</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> Long cust_id;</span><br><span class="line">            <span class="keyword">private</span> String cust_name;</span><br><span class="line">            <span class="keyword">private</span> Long cust_user_id;</span><br><span class="line">            <span class="keyword">private</span> Long cust_create_id;</span><br><span class="line">            <span class="keyword">private</span> String cust_source;</span><br><span class="line">            <span class="keyword">private</span> String cust_industry;</span><br><span class="line">            <span class="keyword">private</span> String cust_level;</span><br><span class="line">            <span class="keyword">private</span> String cust_linkman;</span><br><span class="line">            <span class="keyword">private</span> String cust_phone;</span><br><span class="line">            <span class="keyword">private</span> String cust_mobile;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> Set&lt;Linkman&gt; linkmans = <span class="keyword">new</span> HashSet&lt;Linkman&gt;();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<pre><code>* 联系人的JavaBean如下
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Linkman</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> Long lkm_id;</span><br><span class="line">            <span class="keyword">private</span> String lkm_name;</span><br><span class="line">            <span class="keyword">private</span> String lkm_gender;</span><br><span class="line">            <span class="keyword">private</span> String lkm_phone;</span><br><span class="line">            <span class="keyword">private</span> String lkm_mobile;</span><br><span class="line">            <span class="keyword">private</span> String lkm_email;</span><br><span class="line">            <span class="keyword">private</span> String lkm_qq;</span><br><span class="line">            <span class="keyword">private</span> String lkm_position;</span><br><span class="line">            <span class="keyword">private</span> String lkm_memo;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> Customer customer;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p>编写客户和联系人的映射配置文件（注意一对多的配置编写）</p>
<ul>
<li>客户的映射配置文件如下</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.xujingyang.domain.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_user_id"</span> <span class="attr">column</span>=<span class="string">"cust_user_id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_create_id"</span> <span class="attr">column</span>=<span class="string">"cust_create_id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_linkman"</span> <span class="attr">column</span>=<span class="string">"cust_linkman"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkmans"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.xujingyang.domain.Linkman"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>* 联系人的映射配置文件如下
</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.xujingyang.domain.Linkman"</span> <span class="attr">table</span>=<span class="string">"cst_linkman"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"lkm_id"</span> <span class="attr">column</span>=<span class="string">"lkm_id"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_name"</span> <span class="attr">column</span>=<span class="string">"lkm_name"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_gender"</span> <span class="attr">column</span>=<span class="string">"lkm_gender"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_phone"</span> <span class="attr">column</span>=<span class="string">"lkm_phone"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_mobile"</span> <span class="attr">column</span>=<span class="string">"lkm_mobile"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_email"</span> <span class="attr">column</span>=<span class="string">"lkm_email"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_qq"</span> <span class="attr">column</span>=<span class="string">"lkm_qq"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_position"</span> <span class="attr">column</span>=<span class="string">"lkm_position"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_memo"</span> <span class="attr">column</span>=<span class="string">"lkm_memo"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">class</span>=<span class="string">"com.xujingyang.domain.Customer"</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="技术分析之保存客户和联系人的数据"><a href="#技术分析之保存客户和联系人的数据" class="headerlink" title="技术分析之保存客户和联系人的数据"></a>技术分析之保存客户和联系人的数据</h2><ol>
<li>进行双向关联进行数据的保存</li>
</ol>
<h3 id="技术分析之级联保存"><a href="#技术分析之级联保存" class="headerlink" title="技术分析之级联保存"></a>技术分析之级联保存</h3><ol>
<li><p>测试：如果现在代码只插入其中的一方的数据</p>
<ul>
<li>如果只保存其中的一方的数据，那么程序会抛出异常。</li>
<li><p>如果想完成只保存一方的数据，并且把相关联的数据都保存到数据库中，那么需要配置级联！！</p>
</li>
<li><p>级联保存是方向性</p>
</li>
</ul>
</li>
<li><p>级联保存效果</p>
<ul>
<li>级联保存：保存一方同时可以把关联的对象也保存到数据库中！！</li>
<li>使用cascade=”save-update”</li>
</ul>
</li>
</ol>
<h3 id="技术分析之级联删除"><a href="#技术分析之级联删除" class="headerlink" title="技术分析之级联删除"></a>技术分析之级联删除</h3><ol>
<li><p>先来给大家在数据库中演示含有外键的删除客户功能，那么SQL语句是会报出错误的</p>
<ul>
<li>例如：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from customers where cid = 1;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>如果使用Hibernate框架直接删除客户的时候，测试发现是可以删除的</p>
</li>
<li><p>上述的删除是普通的删除，那么也可以使用级联删除，注意：级联删除也是有方向性的</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* &lt;many-to-one cascade=&quot;delete&quot; /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之级联的取值（cascade的取值）和孤儿删除"><a href="#技术分析之级联的取值（cascade的取值）和孤儿删除" class="headerlink" title="技术分析之级联的取值（cascade的取值）和孤儿删除"></a>技术分析之级联的取值（cascade的取值）和孤儿删除</h3><ol>
<li><p>需要大家掌握的取值如下</p>
<ul>
<li>none                      – 不使用级联</li>
<li>save-update               – 级联保存或更新</li>
<li>delete                    – 级联删除</li>
<li>delete-orphan             – 孤儿删除.(注意：只能应用在一对多关系)</li>
<li>all                       – 除了delete-orphan的所有情况.（包含save-update delete）</li>
<li>all-delete-orphan         – 包含了delete-orphan的所有情况.（包含save-update delete delete-orphan）</li>
</ul>
</li>
<li><p>孤儿删除（孤子删除），只有在一对多的环境下才有孤儿删除</p>
<ul>
<li>在一对多的关系中,可以将一的一方认为是父方.将多的一方认为是子方.孤儿删除:在解除了父子关系的时候.将子方记录就直接删除。</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* &lt;many-to-one cascade=&quot;delete-orphan&quot; /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之让某一方放弃外键的维护，为多对多做准备"><a href="#技术分析之让某一方放弃外键的维护，为多对多做准备" class="headerlink" title="技术分析之让某一方放弃外键的维护，为多对多做准备"></a>技术分析之让某一方放弃外键的维护，为多对多做准备</h3><ol>
<li><p>先测试双方都维护外键的时候，会产生多余的SQL语句。</p>
<ul>
<li><p>想修改客户和联系人的关系，进行双向关联，双方都会维护外键，会产生多余的SQL语句。</p>
</li>
<li><p>产生的原因：session的一级缓存中的快照机制，会让双方都更新数据库，产生了多余的SQL语句。</p>
</li>
</ul>
</li>
<li><p>如果不想产生多余的SQL语句，那么需要一方来放弃外键的维护！</p>
<ul>
<li>在<set>标签上配置一个inverse=”true”.true:放弃.false:不放弃.默认值是false</set></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;inverse=&quot;true&quot;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之cascade和inverse的区别"><a href="#技术分析之cascade和inverse的区别" class="headerlink" title="技术分析之cascade和inverse的区别"></a>技术分析之cascade和inverse的区别</h3><ol>
<li>cascade用来级联操作（保存、修改和删除）</li>
<li>inverse用来维护外键的</li>
</ol>
<h2 id="Hibernate的关联关系映射之多对多映射"><a href="#Hibernate的关联关系映射之多对多映射" class="headerlink" title="Hibernate的关联关系映射之多对多映射"></a>Hibernate的关联关系映射之多对多映射</h2><h3 id="技术分析之多对多的建表原则"><a href="#技术分析之多对多的建表原则" class="headerlink" title="技术分析之多对多的建表原则"></a>技术分析之多对多的建表原则</h3><ol>
<li>JavaWEB的多对多</li>
</ol>
<h3 id="技术分析之多对多JavaBean的编写"><a href="#技术分析之多对多JavaBean的编写" class="headerlink" title="技术分析之多对多JavaBean的编写"></a>技术分析之多对多JavaBean的编写</h3><ol>
<li><p>编写用户和角色的JavaBean</p>
<ul>
<li>用户的JavaBean代码如下</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> Long user_id;</span><br><span class="line">            <span class="keyword">private</span> String user_code;</span><br><span class="line">            <span class="keyword">private</span> String user_name;</span><br><span class="line">            <span class="keyword">private</span> String user_password;</span><br><span class="line">            <span class="keyword">private</span> String user_state;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> HashSet&lt;Role&gt;();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<pre><code>* 角色的JavaBean代码如下
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> Long role_id;</span><br><span class="line">            <span class="keyword">private</span> String role_name;</span><br><span class="line">            <span class="keyword">private</span> String role_memo;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;User&gt;();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>用户和角色的映射配置文件如下</p>
<ul>
<li>用户的映射配置文件如下</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.xujingyang.domain.User"</span> <span class="attr">table</span>=<span class="string">"sys_user"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"user_id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_code"</span> <span class="attr">column</span>=<span class="string">"user_code"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_name"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_password"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_state"</span> <span class="attr">column</span>=<span class="string">"user_state"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"com.xujingyang.domain.Role"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>* 角色的映射配置文件如下
</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.xujingyang.domain.Role"</span> <span class="attr">table</span>=<span class="string">"sys_role"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"role_id"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_name"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_memo"</span> <span class="attr">column</span>=<span class="string">"role_memo"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"com.xujingyang.domain.User"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>多对多进行双向关联的时候:必须有一方去放弃外键维护权</li>
</ol>
<h3 id="技术分析之多对多的级联保存"><a href="#技术分析之多对多的级联保存" class="headerlink" title="技术分析之多对多的级联保存"></a>技术分析之多对多的级联保存</h3><ol>
<li>级联保存</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;set cascade=&quot;save-update&quot;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="级联删除（在多对多中是很少使用的）"><a href="#级联删除（在多对多中是很少使用的）" class="headerlink" title="级联删除（在多对多中是很少使用的）"></a>级联删除（在多对多中是很少使用的）</h3><ol>
<li>级联删除</li>
</ol>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xujingyang.test ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction ;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.demo.Customer ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.demo.LinkMan ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.utils.HibernateUtil ;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> oldmonk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>   2017年4月16日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 双向添加</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getThreadLocalSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer() ;</span><br><span class="line">        customer.setCust_name(<span class="string">"小明"</span>) ;</span><br><span class="line">        </span><br><span class="line">        LinkMan lMan1 = <span class="keyword">new</span> LinkMan() ;</span><br><span class="line">        lMan1.setLkm_name(<span class="string">"小小明1"</span>) ;</span><br><span class="line">        LinkMan lMan2 = <span class="keyword">new</span> LinkMan() ;</span><br><span class="line">        lMan2.setLkm_name(<span class="string">"小小明2"</span>) ;</span><br><span class="line">        </span><br><span class="line">        customer.getLinkmans().add(lMan1) ;</span><br><span class="line">        customer.getLinkmans().add(lMan2) ;</span><br><span class="line">        lMan1.setCustomer(customer) ;</span><br><span class="line">        lMan2.setCustomer(customer) ;</span><br><span class="line">        </span><br><span class="line">        session.save(customer) ;</span><br><span class="line">        session.save(lMan1) ;</span><br><span class="line">        session.save(lMan2) ;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 级联添加, 客户配置中添加cascade="all"此时还维护外建,会执行两次重复的sql语句 ,</span></span><br><span class="line"><span class="comment">     * 添加 inverse="true"时,表明客户表不维护外键,不会重复执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getThreadLocalSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer() ;</span><br><span class="line">        customer.setCust_name(<span class="string">"小明"</span>) ;</span><br><span class="line">        </span><br><span class="line">        LinkMan lMan1 = <span class="keyword">new</span> LinkMan() ;</span><br><span class="line">        lMan1.setLkm_name(<span class="string">"小小明1"</span>) ;</span><br><span class="line">        LinkMan lMan2 = <span class="keyword">new</span> LinkMan() ;</span><br><span class="line">        lMan2.setLkm_name(<span class="string">"小小明2"</span>) ;</span><br><span class="line">        </span><br><span class="line">        customer.getLinkmans().add(lMan1) ;</span><br><span class="line">        customer.getLinkmans().add(lMan2) ;</span><br><span class="line">        </span><br><span class="line">        session.save(customer) ;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通删除,此时会把关联的外建表的列对应的外建置为null</span></span><br><span class="line"><span class="comment">     * 不添加任何的delete</span></span><br><span class="line"><span class="comment">     * 删除客户的时候 删除联系人：</span></span><br><span class="line"><span class="comment">     * 需要在Customer.hbm.xml中set标签上配置cascade="delete"</span></span><br><span class="line"><span class="comment">     * 删除联系人 同时删除 客户：</span></span><br><span class="line"><span class="comment">     * 需要在LinkMan.hbm.xml中many-to-one标签上配置cascade="delete"</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getThreadLocalSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Customer customer = session.get(Customer.class, <span class="number">1L</span>) ;</span><br><span class="line">        </span><br><span class="line">        session.delete(customer) ;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 孤儿删除, &lt;set cascade="delete-orphan" /&gt;,跟我解除关系,就把你删了</span></span><br><span class="line"><span class="comment">     * 不添加时,只是解除关系,外建置为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getThreadLocalSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Customer customer = session.get(Customer.class, <span class="number">1L</span>) ;</span><br><span class="line">        </span><br><span class="line">        LinkMan linkMan = session.get(LinkMan.class, <span class="number">1L</span>) ;</span><br><span class="line">        customer.getLinkmans().remove(linkMan) ;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="hibernate之各种查询"><a href="#hibernate之各种查询" class="headerlink" title="hibernate之各种查询"></a>hibernate之各种查询</h1><ol>
<li>Hibernate的查询方式</li>
<li>Hibernate的查询策略</li>
</ol>
<h2 id="案例：使用Hibernate完成查询所有联系人功能"><a href="#案例：使用Hibernate完成查询所有联系人功能" class="headerlink" title="案例：使用Hibernate完成查询所有联系人功能"></a>案例：使用Hibernate完成查询所有联系人功能</h2><h3 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h3><ol>
<li>完成所有的联系人的查询</li>
</ol>
<p>技术分析之Hibernate框架的查询方式</p>
<ol>
<li><p>唯一标识OID的检索方式</p>
<ul>
<li>session.get(对象.class,OID)</li>
</ul>
</li>
<li><p>对象的导航的方式</p>
</li>
<li><p>HQL的检索方式</p>
<ul>
<li>Hibernate Query Language  – Hibernate的查询语言</li>
</ul>
</li>
<li><p>QBC的检索方式</p>
<ul>
<li>Query By Criteria – 条件查询</li>
</ul>
</li>
<li><p>SQL检索方式（了解）</p>
<ul>
<li>本地的SQL检索</li>
</ul>
</li>
</ol>
<h3 id="技术分析之HQL的查询方式概述"><a href="#技术分析之HQL的查询方式概述" class="headerlink" title="技术分析之HQL的查询方式概述"></a>技术分析之HQL的查询方式概述</h3><ol>
<li><p>HQL的介绍</p>
<ul>
<li>HQL(Hibernate Query Language) 是面向对象的查询语言, 它和 SQL 查询语言有些相似</li>
<li>在 Hibernate 提供的各种检索方式中, HQL 是使用最广的一种检索方式</li>
</ul>
</li>
<li><p>HQL与SQL的关系</p>
<ul>
<li>HQL 查询语句是面向对象的,Hibernate负责解析HQL查询语句, 然后根据对象-关系映射文件中的映射信息, 把 HQL 查询语句翻译成相应的 SQL 语句. </li>
<li>HQL 查询语句中的主体是域模型中的类及类的属性</li>
<li>SQL 查询语句是与关系数据库绑定在一起的. SQL查询语句中的主体是数据库表及表的字段</li>
</ul>
</li>
</ol>
<h3 id="技术分析之HQL的查询演示"><a href="#技术分析之HQL的查询演示" class="headerlink" title="技术分析之HQL的查询演示"></a>技术分析之HQL的查询演示</h3><ol>
<li><p>HQL基本的查询格式</p>
<ul>
<li>支持方法链的编程，即直接调用list()方法</li>
<li>简单的代码如下</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.createQuery(<span class="string">"from Customer"</span>).list();</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>使用别名的方式</p>
<ul>
<li>可以使用别名的方式</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">session.createQuery(<span class="string">"from Customer c"</span>).list();</span><br><span class="line">session.createQuery(<span class="string">"select c from Customer c"</span>).list();</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>排序查询</p>
<ul>
<li>排序查询和SQL语句中的排序的语法是一样的<ul>
<li>升序</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.createQuery(<span class="string">"from Customer order by cust_id"</span>).list();</span><br></pre></td></tr></table></figure>
<pre><code>* 降序
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.createQuery(<span class="string">"from Customer order by cust_id desc"</span>).list();</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p>分页查询</p>
<ul>
<li>Hibernate框架提供了分页的方法，咱们可以调用方法来完成分页</li>
<li><p>两个方法如下</p>
<ul>
<li>setFirstResult(a)     – 从哪条记录开始，如果查询是从第一条开启，值是0</li>
<li>setMaxResults(b)      – 每页查询的记录条数</li>
</ul>
</li>
<li><p>演示代码如下</p>
</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LinkMan&gt; list = session.createQuery(<span class="string">"from LinkMan"</span>).setFirstResult(<span class="number">0</span>).setMaxResults().list();</span><br></pre></td></tr></table></figure>
<ol start="5">
<li><p>带条件的查询</p>
<ul>
<li>setParameter(“?号的位置，默认从0开始”,”参数的值”); 不用考虑参数的具体类型</li>
<li>按位置绑定参数的条件查询（指定下标值，默认从0开始）</li>
<li>按名称绑定参数的条件查询（HQL语句中的 ? 号换成 :名称 的方式）</li>
<li>例如代码如下</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Query query = session.createQuery(<span class="string">"from Linkman where lkm_name like ? order by lkm_id desc"</span>);</span><br><span class="line">        query.setFirstResult(<span class="number">0</span>).setMaxResults(<span class="number">3</span>);</span><br><span class="line">        query.setParameter(<span class="number">0</span>, <span class="string">"%熊%"</span>);</span><br><span class="line">        List&lt;Linkman&gt; list = query.list();</span><br><span class="line">        <span class="keyword">for</span> (Linkman linkman : list) &#123;</span><br><span class="line">            System.out.println(linkman);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="HQL的投影查询"><a href="#HQL的投影查询" class="headerlink" title="HQL的投影查询"></a>HQL的投影查询</h4><ol>
<li>投影查询就是想查询某一字段的值或者某几个字段的值</li>
<li><p>投影查询的案例</p>
<ul>
<li>如果查询多个字段，例如下面这种方式</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Object[]&gt; list = session.createQuery(<span class="string">"select c.cust_name,c.cust_level from Customer c"</span>).list();</span><br><span class="line">        <span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(objects));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<pre><code>* 如果查询两个字段，也可以把这两个字段封装到对象中
    * 先在持久化类中提供对应字段的构造方法
    * 使用下面这种HQL语句的方式
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Customer&gt; list = session.createQuery(<span class="string">"select new Customer(c.cust_name,c.cust_level) from Customer c"</span>).list();</span><br><span class="line">            <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">                System.out.println(customer);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之聚合函数查询"><a href="#技术分析之聚合函数查询" class="headerlink" title="技术分析之聚合函数查询"></a>技术分析之聚合函数查询</h3><ol>
<li>获取总的记录数</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">    Transaction tr = session.beginTransaction();</span><br><span class="line">    List&lt;Number&gt; list = session.createQuery(<span class="string">"select count(c) from Customer c"</span>).list();</span><br><span class="line">    Long count = list.get(<span class="number">0</span>).longValue();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">    tr.commit();</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>获取某一列数据的和</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">    Transaction tr = session.beginTransaction();</span><br><span class="line">    List&lt;Number&gt; list = session.createQuery(<span class="string">"select sum(c.cust_id) from Customer c"</span>).list();</span><br><span class="line">    Long count = list.get(<span class="number">0</span>).longValue();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">    tr.commit();</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之QBC检索方式"><a href="#技术分析之QBC检索方式" class="headerlink" title="技术分析之QBC检索方式"></a>技术分析之QBC检索方式</h3><ol start="0">
<li><p>QBC：Query By Criteria  按条件进行查询</p>
</li>
<li><p>简单查询，使用的是Criteria接口</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Customer&gt; list = session.createCriteria(Customer.class).list();</span><br><span class="line">    <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>排序查询</p>
<ul>
<li>需要使用addOrder()的方法来设置参数，参数使用org.hibernate.criterion.Order对象</li>
<li>具体代码如下：</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        Criteria criteria = session.createCriteria(Linkman.class);</span><br><span class="line">        <span class="comment">// 设置排序</span></span><br><span class="line">        criteria.addOrder(Order.desc(<span class="string">"lkm_id"</span>));</span><br><span class="line">        List&lt;Linkman&gt; list = criteria.list();</span><br><span class="line">        <span class="keyword">for</span> (Linkman linkman : list) &#123;</span><br><span class="line">            System.out.println(linkman);</span><br><span class="line">        &#125;</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>分页查询</p>
<ul>
<li><p>QBC的分页查询也是使用两个方法</p>
<ul>
<li>setFirstResult();</li>
<li>setMaxResults();</li>
</ul>
</li>
<li><p>代码如下;</p>
</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        Criteria criteria = session.createCriteria(Linkman.class);</span><br><span class="line">        <span class="comment">// 设置排序</span></span><br><span class="line">        criteria.addOrder(Order.desc(<span class="string">"lkm_id"</span>));</span><br><span class="line">        criteria.setFirstResult(<span class="number">0</span>);</span><br><span class="line">        criteria.setMaxResults(<span class="number">3</span>);</span><br><span class="line">        List&lt;Linkman&gt; list = criteria.list();</span><br><span class="line">        <span class="keyword">for</span> (Linkman linkman : list) &#123;</span><br><span class="line">            System.out.println(linkman);</span><br><span class="line">        &#125;</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>条件查询</li>
</ol>
<p>（Criterion是查询条件的接口，Restrictions类是Hibernate框架提供的工具类，使用该工具类来设置查询条件）</p>
<pre><code>* 条件查询使用Criteria接口的add方法，用来传入条件。
* 使用Restrictions的添加条件的方法，来添加条件，例如：
    * Restrictions.eq           -- 相等
    * Restrictions.gt           -- 大于号
    * Restrictions.ge           -- 大于等于
    * Restrictions.lt           -- 小于
    * Restrictions.le           -- 小于等于
    * Restrictions.between      -- 在之间
    * Restrictions.like         -- 模糊查询
    * Restrictions.in           -- 范围
    * Restrictions.and          -- 并且
    * Restrictions.or           -- 或者

* 测试代码如下
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        Criteria criteria = session.createCriteria(Linkman.class);</span><br><span class="line">        <span class="comment">// 设置排序</span></span><br><span class="line">        criteria.addOrder(Order.desc(<span class="string">"lkm_id"</span>));</span><br><span class="line">        <span class="comment">// 设置查询条件</span></span><br><span class="line">        criteria.add(Restrictions.or(Restrictions.eq(<span class="string">"lkm_gender"</span>, <span class="string">"男"</span>), Restrictions.gt(<span class="string">"lkm_id"</span>, <span class="number">3L</span>)));</span><br><span class="line">        List&lt;Linkman&gt; list = criteria.list();</span><br><span class="line">        <span class="keyword">for</span> (Linkman linkman : list) &#123;</span><br><span class="line">            System.out.println(linkman);</span><br><span class="line">        &#125;</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>聚合函数查询</li>
</ol>
<p>（Projection的聚合函数的接口，而Projections是Hibernate提供的工具类，使用该工具类设置聚合函数查询）</p>
<pre><code>* 使用QBC的聚合函数查询，需要使用criteria.setProjection()方法
* 具体的代码如下
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        Criteria criteria = session.createCriteria(Linkman.class);</span><br><span class="line">        criteria.setProjection(Projections.rowCount());</span><br><span class="line">        List&lt;Number&gt; list = criteria.list();</span><br><span class="line">        Long count = list.get(<span class="number">0</span>).longValue();</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之离线条件查询"><a href="#技术分析之离线条件查询" class="headerlink" title="技术分析之离线条件查询"></a>技术分析之离线条件查询</h3><ol>
<li>离线条件查询使用的是DetachedCriteria接口进行查询，离线条件查询对象在创建的时候，不需要使用Session对象，只是在查询的时候使用Session对象即可。</li>
<li>创建离线条件查询对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DetachedCriteria criteria = DetachedCriteria.forClass(Linkman.class);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>具体的代码如下</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">    Transaction tr = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">    DetachedCriteria criteria = DetachedCriteria.forClass(Linkman.class);</span><br><span class="line">    <span class="comment">// 设置查询条件</span></span><br><span class="line">    criteria.add(Restrictions.eq(<span class="string">"lkm_gender"</span>, <span class="string">"男"</span>));</span><br><span class="line">    <span class="comment">// 查询数据</span></span><br><span class="line">    List&lt;Linkman&gt; list = criteria.getExecutableCriteria(session).list();</span><br><span class="line">    <span class="keyword">for</span> (Linkman linkman : list) &#123;</span><br><span class="line">        System.out.println(linkman);</span><br><span class="line">    &#125;</span><br><span class="line">    tr.commit();</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之SQL查询方式（了解）"><a href="#技术分析之SQL查询方式（了解）" class="headerlink" title="技术分析之SQL查询方式（了解）"></a>技术分析之SQL查询方式（了解）</h3><ol>
<li>基本语法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">    Transaction tr = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">    SQLQuery sqlQuery = session.createSQLQuery(<span class="string">"select * from cst_linkman where lkm_gender = ?"</span>);</span><br><span class="line">    sqlQuery.setParameter(<span class="number">0</span>,<span class="string">"男"</span>);</span><br><span class="line">    sqlQuery.addEntity(Linkman.class);</span><br><span class="line">    List&lt;Linkman&gt; list = sqlQuery.list();</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    tr.commit();</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之HQL多表查询"><a href="#技术分析之HQL多表查询" class="headerlink" title="技术分析之HQL多表查询"></a>技术分析之HQL多表查询</h3><ol>
<li>多表的查询进来使用HQL语句进行查询，HQL语句和SQL语句的查询语法比较类似。</li>
</ol>
<pre><code>* 内连接查询
    * 显示内连接
</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers c <span class="keyword">inner</span> <span class="keyword">join</span> orders o <span class="keyword">on</span> c.cid = o.cno;</span><br></pre></td></tr></table></figure>
<pre><code>* 隐式内连接
</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers c,orders o <span class="keyword">where</span> c.cid = o.cno;</span><br></pre></td></tr></table></figure>
<pre><code>* 外连接查询
    * 左外连接
</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers c <span class="keyword">left</span> <span class="keyword">join</span> orders o <span class="keyword">on</span> c.cid = o.cno;</span><br></pre></td></tr></table></figure>
<pre><code>* 右外连接
</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers c <span class="keyword">right</span> <span class="keyword">join</span> orders o <span class="keyword">on</span> c.cid = o.cno;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>HQL的多表查询</p>
<ul>
<li>迫切和非迫切：<ul>
<li>非迫切返回结果是Object[]</li>
<li>迫切连接返回的结果是对象，把客户的信息封装到客户的对象中，把订单的信息封装到客户的Set集合中。</li>
</ul>
</li>
</ul>
</li>
<li><p>内连接查询</p>
<ul>
<li>内连接使用 inner join ，默认返回的是Object数组</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        List&lt;Object[]&gt; list = session.createQuery(<span class="string">"from Customer c inner join c.linkmans"</span>).list();</span><br><span class="line">        <span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(objects));</span><br><span class="line">        &#125;</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<pre><code>* 迫切内连接:inner join fetch ，返回的是实体对象
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        List&lt;Customer&gt; list = session.createQuery(<span class="string">"from Customer c inner join fetch c.linkmans"</span>).list();</span><br><span class="line">        Set&lt;Customer&gt; set = <span class="keyword">new</span> HashSet&lt;Customer&gt;(list);</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : set) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p>左外连接查询</p>
<ul>
<li><p>左外连接: 封装成List&lt;Object[]&gt;</p>
</li>
<li><p>迫切左外连接</p>
</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        List&lt;Customer&gt; list = session.createQuery(<span class="string">"from Customer c left join fetch c.linkmans"</span>).list();</span><br><span class="line">        Set&lt;Customer&gt; set = <span class="keyword">new</span> HashSet&lt;Customer&gt;(list);</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : set) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<p>案例一代码实现</p>
<h2 id="案例二：对查询功能优化"><a href="#案例二：对查询功能优化" class="headerlink" title="案例二：对查询功能优化"></a>案例二：对查询功能优化</h2><h3 id="需求分析-2"><a href="#需求分析-2" class="headerlink" title="需求分析"></a>需求分析</h3><ol>
<li>对Hibernate框架的查询进行优化</li>
</ol>
<h3 id="技术分析之延迟加载"><a href="#技术分析之延迟加载" class="headerlink" title="技术分析之延迟加载"></a>技术分析之延迟加载</h3><ol>
<li>延迟加载先获取到代理对象，当真正使用到该对象中的属性的时候，才会发送SQL语句，是Hibernate框架提升性能的方式</li>
<li><p>类级别的延迟加载</p>
<ul>
<li>Session对象的load方法默认就是延迟加载</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Customer c = session.load(Customer.class, <span class="number">1L</span>);</span><br></pre></td></tr></table></figure>
<p>没有发送SQL语句，当使用该对象的属性时，才发送SQL语句</p>
<pre><code>* 使类级别的延迟加载失效
    * 在&lt;class&gt;标签上配置lazy=”false”
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hibernate.initialize(Object proxy);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>关联级别的延迟加载（查询某个客户，当查看该客户下的所有联系人是是否是延迟加载）</p>
<ul>
<li>默认是延迟加载</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">        Transaction tr = session.beginTransaction();</span><br><span class="line">        Customer c = session.get(Customer.class, <span class="number">1L</span>);</span><br><span class="line">        System.out.println(<span class="string">"============="</span>);</span><br><span class="line">        System.out.println(c.getLinkmans().size());</span><br><span class="line">        tr.commit();</span><br></pre></td></tr></table></figure>
<h3 id="技术分析之Hibernate框架的查询策略"><a href="#技术分析之Hibernate框架的查询策略" class="headerlink" title="技术分析之Hibernate框架的查询策略"></a>技术分析之Hibernate框架的查询策略</h3><ol>
<li>查询策略：</li>
</ol>
<p>使用Hibernate查询一个对象的时候，查询其关联对象.应该如何查询.是Hibernate的一种优化手段!!! </p>
<ol start="2">
<li><p>Hibernate框架的检索策略解决的问题</p>
<ul>
<li>查询的时机</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Customer c1 = (Customer) session.get(Customer.class, <span class="number">1</span>);</span><br><span class="line">        System.out.println(c1.getLinkmans().size());</span><br></pre></td></tr></table></figure>
<pre><code>    * lazy属性解决查询的时机的问题，需要配置是否采用延迟加载！！

* 查询的语句形式
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Customer&gt; list = session.createQuery(<span class="string">"from Customer"</span>).list();</span><br><span class="line">        <span class="keyword">for</span>(Customer c : list)&#123;</span><br><span class="line">            System.out.println(c.getLinkmans());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<pre><code>* fetch属性就可以解决查询语句的形式的问题！！
</code></pre><h3 id="技术分析之在set标签上配置策略"><a href="#技术分析之在set标签上配置策略" class="headerlink" title="技术分析之在set标签上配置策略"></a>技术分析之在set标签上配置策略</h3><ol>
<li><p>在<set>标签上使用fetch和lazy属性</set></p>
<ul>
<li><p>fetch的取值              – 控制SQL语句生成的格式</p>
<ul>
<li>select                – 默认值.发送查询语句</li>
<li>join                  – 连接查询.发送的是一条迫切左外连接!!!配置了join.lazy就失效了</li>
<li>subselect             – 子查询.发送一条子查询查询其关联对象.(需要使用list()方法进行测试)</li>
</ul>
</li>
<li><p>lazy的取值               – 查找关联对象的时候是否采用延迟!</p>
<ul>
<li>true                  – 默认.延迟</li>
<li>false                 – 不延迟</li>
<li>extra                 – 及其懒惰</li>
</ul>
</li>
</ul>
</li>
<li><p>set标签上的默认值是fetch=”select”和lazy=”true”</p>
</li>
<li><p>总结：Hibernate框架都采用了默认值，开发中基本上使用的都是默认值。特殊的情况。</p>
</li>
</ol>
<h3 id="技术分析之在man-to-one标签上配置策略"><a href="#技术分析之在man-to-one标签上配置策略" class="headerlink" title="技术分析之在man-to-one标签上配置策略"></a>技术分析之在man-to-one标签上配置策略</h3><ol>
<li><p>在<many-to-one>标签上使用fetch和lazy属性</many-to-one></p>
<ul>
<li><p>fetch的取值      – 控制SQL的格式.</p>
<ul>
<li>select        – 默认。发送基本select语句查询</li>
<li>join          – 发送迫切左外连接查询</li>
</ul>
</li>
<li><p>lazy的取值       – 控制加载关联对象是否采用延迟.</p>
<ul>
<li>false         – 不采用延迟加载.</li>
<li>proxy         – 默认值.代理.现在是否采用延迟.<ul>
<li>由另一端的<class>上的lazy确定.如果这端的class上的lazy=”true”.proxy的值就是true(延迟加载).</class></li>
<li>如果class上lazy=”false”.proxy的值就是false(不采用延迟.)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>在<many-to-one>标签上的默认值是fetch=”select”和proxy</many-to-one></p>
</li>
</ol>
<p>代码实现</p>
<p>　　TestHQLDemo<br>　　<br>　　<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xujingyang.test ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Query ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction ;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.utils.HibernateUtil ;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> oldmonk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>   2017年4月19日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHQLDemo</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        Query query = session.createQuery(<span class="string">"from Customer order by cust_id desc"</span>) ;</span><br><span class="line">        List&lt;Customer&gt; list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检索查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        <span class="comment">// Query query = session.createQuery("from Customer where cust_id=?") ;</span></span><br><span class="line">        <span class="comment">// query.setLong(0, 2L);</span></span><br><span class="line">        Query query = session.createQuery(<span class="string">"from Customer where cust_id=2"</span>) ;</span><br><span class="line">        List&lt;Customer&gt; list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        Query query = session.createQuery(<span class="string">"from Customer"</span>) ;</span><br><span class="line">        query.setFirstResult(<span class="number">0</span>) ;<span class="comment">// 从第几条记录开始</span></span><br><span class="line">        query.setMaxResults(<span class="number">2</span>) ;<span class="comment">// 每页显示几条数据</span></span><br><span class="line">        List&lt;Customer&gt; list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 统计查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        Query query = session.createQuery(<span class="string">"select count(1) from Customer"</span>) ;</span><br><span class="line">        List list = query.list() ;</span><br><span class="line">        System.out.println(list.get(<span class="number">0</span>)) ;</span><br><span class="line">        </span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 投影查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        Query query = session.createQuery(<span class="string">"select cust_id from Customer"</span>) ;</span><br><span class="line">        List list = query.list() ;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">            System.err.println(object) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Query query = session.createQuery(<span class="string">"from Customer c inner join fetch c.linkmans "</span>) ;</span><br><span class="line">        List&lt;Object []&gt; list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Object [] objects : list) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Object object : objects) &#123;</span><br><span class="line">                System.out.println(object) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 迫切内连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Query query = session.createQuery(<span class="string">"from Customer c inner join fetch c.linkmans "</span>) ;</span><br><span class="line">        List&lt;Customer&gt; list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 外连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Query query = session.createQuery(<span class="string">"from Customer c left join fetch c.linkmans "</span>) ;</span><br><span class="line">        List&lt;Customer&gt; list = query.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>TestQBCDemo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xujingyang.test ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Criteria ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Order ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Projection ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Projections ;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions ;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test ;</span><br><span class="line"><span class="keyword">import</span> com.xujingyang.utils.HibernateUtil ;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> oldmonk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>   2017年4月19日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestQBCDemo</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基本查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class) ;</span><br><span class="line">        List&lt;Customer&gt; list = criteria.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 条件查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class) ;</span><br><span class="line">        <span class="comment">// criteria.add(Restrictions.gt("cust_id", 3L));</span></span><br><span class="line">        criteria.add(Restrictions.between(<span class="string">"cust_id"</span>, <span class="number">3L</span>, <span class="number">4L</span>)) ;</span><br><span class="line">        List&lt;Customer&gt; list = criteria.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class) ;</span><br><span class="line">        criteria.setFirstResult(<span class="number">0</span>) ;</span><br><span class="line">        criteria.setMaxResults(<span class="number">2</span>) ;</span><br><span class="line">        List&lt;Customer&gt; list = criteria.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class) ;</span><br><span class="line">        criteria.addOrder(Order.desc(<span class="string">"cust_id"</span>)) ;</span><br><span class="line">        List&lt;Customer&gt; list = criteria.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 统计查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class) ;</span><br><span class="line">        <span class="comment">// criteria.setProjection(Projections.id());</span></span><br><span class="line">        criteria.setProjection(Projections.sum(<span class="string">"cust_id"</span>)) ;</span><br><span class="line">        List list = criteria.list() ;</span><br><span class="line">        <span class="keyword">for</span> (Object obj : list) &#123;</span><br><span class="line">            System.out.println(obj) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 离线条件查询:DetachedCriteria(SSH整合经常使用.).</span></span><br><span class="line"><span class="comment">     * * 可以脱离session设置参数.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria detachedCriteria = DetachedCriteria.forClass(Customer.class) ;</span><br><span class="line">        detachedCriteria.add(Restrictions.gt(<span class="string">"cust_id"</span>, <span class="number">3L</span>)) ;</span><br><span class="line">        Session session = HibernateUtil.getSession() ;</span><br><span class="line">        Transaction transaction = session.beginTransaction() ;</span><br><span class="line">        </span><br><span class="line">        List list = detachedCriteria.getExecutableCriteria(session).list() ;</span><br><span class="line">        <span class="keyword">for</span> (Object obj : list) &#123;</span><br><span class="line">            System.out.println(obj) ;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Hibernate" >
    <span class="tag-code">Hibernate</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/blog/44393.html">
        <span class="nav-arrow">← </span>
        
          Java技术重点回顾
        
      </a>
    
    
      <a class="nav-right" href="/blog/36591.html">
        
          Java工具类总结
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#hibernate框架的搭建"><span class="toc-nav-text">hibernate框架的搭建</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Hibernate框架的概述"><span class="toc-nav-text">Hibernate框架的概述</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#什么是ORM（对象关系映射）"><span class="toc-nav-text">什么是ORM（对象关系映射）</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Hibernate优点"><span class="toc-nav-text">Hibernate优点</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#技术分析之Hibernate框架的快速入门"><span class="toc-nav-text">技术分析之Hibernate框架的快速入门</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第一步：下载Hibernate5的运行环境"><span class="toc-nav-text">第一步：下载Hibernate5的运行环境</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第二步：创建表结构"><span class="toc-nav-text">第二步：创建表结构</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第三步：搭建Hibernate的开发环境"><span class="toc-nav-text">第三步：搭建Hibernate的开发环境</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第四步：编写JavaBean实体类"><span class="toc-nav-text">第四步：编写JavaBean实体类</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第五步：创建类与表结构的映射"><span class="toc-nav-text">第五步：创建类与表结构的映射</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第六步：编写Hibernate核心的配置文件"><span class="toc-nav-text">第六步：编写Hibernate核心的配置文件</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#回忆：快速入门"><span class="toc-nav-text">回忆：快速入门</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第七步：编写Hibernate入门代码"><span class="toc-nav-text">第七步：编写Hibernate入门代码</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#第八步：编写Hibernate的SessionFactory工具类"><span class="toc-nav-text">第八步：编写Hibernate的SessionFactory工具类</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#技术分析之：Hibernate常用的配置文件"><span class="toc-nav-text">技术分析之：Hibernate常用的配置文件</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Hibernate配置文件之映射配置文件"><span class="toc-nav-text">Hibernate配置文件之映射配置文件</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Hibernate配置文件之核心配置文件"><span class="toc-nav-text">Hibernate配置文件之核心配置文件</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#技术分析之Hibernate常用的接口和类"><span class="toc-nav-text">技术分析之Hibernate常用的接口和类</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Configuration类和作用"><span class="toc-nav-text">Configuration类和作用</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#SessionFactory：重要"><span class="toc-nav-text">SessionFactory：重要</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Session接口"><span class="toc-nav-text">Session接口</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Transaction接口"><span class="toc-nav-text">Transaction接口</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Hibernate特点"><span class="toc-nav-text">Hibernate特点</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Hibernate的持久化类"><span class="toc-nav-text">Hibernate的持久化类</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#什么是持久化类"><span class="toc-nav-text">什么是持久化类</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#持久化类的编写规则"><span class="toc-nav-text">持久化类的编写规则</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#区分自然主键和代理主键"><span class="toc-nav-text">区分自然主键和代理主键</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#主键的生成策略"><span class="toc-nav-text">主键的生成策略</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Hibernate持久化对象的状态"><span class="toc-nav-text">Hibernate持久化对象的状态</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#持久化对象的状态"><span class="toc-nav-text">持久化对象的状态</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Hibernate持久化对象的状态的转换"><span class="toc-nav-text">Hibernate持久化对象的状态的转换</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Hibernate的一级缓存"><span class="toc-nav-text">Hibernate的一级缓存</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Session对象的一级缓存（重点）"><span class="toc-nav-text">Session对象的一级缓存（重点）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#控制Session的一级缓存（了解）"><span class="toc-nav-text">控制Session的一级缓存（了解）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Hibernate中的事务与并发"><span class="toc-nav-text">Hibernate中的事务与并发</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#事务相关的概念"><span class="toc-nav-text">事务相关的概念</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#丢失更新的问题"><span class="toc-nav-text">丢失更新的问题</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#绑定本地的Session"><span class="toc-nav-text">绑定本地的Session</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Hibernate框架的查询方式"><span class="toc-nav-text">Hibernate框架的查询方式</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Query查询接口"><span class="toc-nav-text">Query查询接口</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Criteria查询接口（做条件查询非常合适）"><span class="toc-nav-text">Criteria查询接口（做条件查询非常合适）</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#hibernate之关联关系映射"><span class="toc-nav-text">hibernate之关联关系映射</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#案例：完成CRM的联系人的保存操作"><span class="toc-nav-text">案例：完成CRM的联系人的保存操作</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#需求分析"><span class="toc-nav-text">需求分析</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#实现过程"><span class="toc-nav-text">实现过程</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#技术分析之保存客户和联系人的数据"><span class="toc-nav-text">技术分析之保存客户和联系人的数据</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之级联保存"><span class="toc-nav-text">技术分析之级联保存</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之级联删除"><span class="toc-nav-text">技术分析之级联删除</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之级联的取值（cascade的取值）和孤儿删除"><span class="toc-nav-text">技术分析之级联的取值（cascade的取值）和孤儿删除</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之让某一方放弃外键的维护，为多对多做准备"><span class="toc-nav-text">技术分析之让某一方放弃外键的维护，为多对多做准备</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之cascade和inverse的区别"><span class="toc-nav-text">技术分析之cascade和inverse的区别</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Hibernate的关联关系映射之多对多映射"><span class="toc-nav-text">Hibernate的关联关系映射之多对多映射</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之多对多的建表原则"><span class="toc-nav-text">技术分析之多对多的建表原则</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之多对多JavaBean的编写"><span class="toc-nav-text">技术分析之多对多JavaBean的编写</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之多对多的级联保存"><span class="toc-nav-text">技术分析之多对多的级联保存</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#级联删除（在多对多中是很少使用的）"><span class="toc-nav-text">级联删除（在多对多中是很少使用的）</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#hibernate之各种查询"><span class="toc-nav-text">hibernate之各种查询</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#案例：使用Hibernate完成查询所有联系人功能"><span class="toc-nav-text">案例：使用Hibernate完成查询所有联系人功能</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#需求分析-1"><span class="toc-nav-text">需求分析</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之HQL的查询方式概述"><span class="toc-nav-text">技术分析之HQL的查询方式概述</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之HQL的查询演示"><span class="toc-nav-text">技术分析之HQL的查询演示</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#HQL的投影查询"><span class="toc-nav-text">HQL的投影查询</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之聚合函数查询"><span class="toc-nav-text">技术分析之聚合函数查询</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之QBC检索方式"><span class="toc-nav-text">技术分析之QBC检索方式</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之离线条件查询"><span class="toc-nav-text">技术分析之离线条件查询</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之SQL查询方式（了解）"><span class="toc-nav-text">技术分析之SQL查询方式（了解）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之HQL多表查询"><span class="toc-nav-text">技术分析之HQL多表查询</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#案例二：对查询功能优化"><span class="toc-nav-text">案例二：对查询功能优化</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#需求分析-2"><span class="toc-nav-text">需求分析</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之延迟加载"><span class="toc-nav-text">技术分析之延迟加载</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之Hibernate框架的查询策略"><span class="toc-nav-text">技术分析之Hibernate框架的查询策略</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之在set标签上配置策略"><span class="toc-nav-text">技术分析之在set标签上配置策略</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#技术分析之在man-to-one标签上配置策略"><span class="toc-nav-text">技术分析之在man-to-one标签上配置策略</span></a></li></ol></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://m.iskei.cn/blog/37268.html';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "imcco";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "hibernate框架技术",
        owner: "imcco",
        repo: "m.github.io",
        oauth: {
          client_id: "ee7ec372a862879e3f2c",
          client_secret: "00a58ccb1a0555f87a87dc3a1b779ee8d12ded80"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2018 | Proudly powered by <a href="https://vuejs.io" target="_blank">vueJs</a>
    <br>
    Theme by <a href="https://github.com/imcco">Imcco</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>

  </body>
</html>