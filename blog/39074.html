<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="Java technology blog.">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Freemaker开发学习笔记 | Keis Note
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Keis Note</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Freemaker开发学习笔记</h2>
  <p class="post-date">2017-12-06</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p><img src="http://ovi3ob9p4.bkt.clouddn.com/TIETU/CT0036.jpg" alt="image"></p>
<p>Freemaker是一个强大的模板引擎，相比velocity而言，其强大的过程调用、递归和闭包回调功能让freemaker可以完成几乎所有我们所想的功能。从个人看法而言，freemaker完全有能力作为MDA的代码辅助生成工具。<br><a id="more"></a><br>本文试图越过传统的概念性介绍，通过一组例子直接把读者带入到Freemaker应用的较高层阶。</p>
<p>大家看文章标题就应该知道，我想用一篇文章，把大家从对freemaker的陌生直接带入到比较深入的境界，所以不想说一些基础性的东西，如果大家不习惯我的表达方法，大可通过google去找习惯于自己阅读方式的相关文章。<br>我用过velocity，最近才用freemaker，才知道我以前的选择是错了，因为velocity不支持过程的调用，所以我为velocity增加了很多的东西，写了很多代码，而且脚本也累赘得要命。freemaker首先吸引我的是它强大的过程调用和递归处理能力，其次则是xml风格的语法结构有着明显的边界，不象velocity要注意段落之间要留空格。所以我建议大家直接使用Freemaker，虽然freemaker没有.net版本，我想不嵌入程序中使用的话，freemaker是绝对的首选。（题外话，谁有兴趣移植一个NFreeMaker？）<br>在使用之前我们先要设置运行环境，在使用Freemaker的时候，我们需要下载相关的程序：</p>
<ul>
<li>freemaker: <a href="http://freemarker.sourceforge.net/" target="_blank" rel="noopener">http://freemarker.sourceforge.net/</a></li>
<li>fmpp: <a href="http://fmpp.sourceforge.net/" target="_blank" rel="noopener">http://fmpp.sourceforge.net/</a></li>
</ul>
<p>其中fmpp是一个freemaker的辅助工具，有了它，我们可以实现更多的功能。以下例子必须fmpp辅助。<br>这里我们首先提出问题。大家看如下的一个xml文件，虽然freemaker的能力不仅在于处理xml文件，但是用xml作为例子更直观一些：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version='1.0' encoding="gb2312" ?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">types</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"urn:DruleForm-Lite.xsd"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">type</span> <span class="attr">name</span>=<span class="string">"Type1"</span> &gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">labels</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">label</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span> <span class="attr">value</span>=<span class="string">"投保单"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">labels</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field11"</span> <span class="attr">type</span>=<span class="string">"Float"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"1"</span> &gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">labels</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">label</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span> <span class="attr">value</span>=<span class="string">"投保单ID"</span>/&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">labels</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field12"</span> <span class="attr">type</span>=<span class="string">"String"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field13"</span> <span class="attr">type</span>=<span class="string">"Integer"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field14"</span> <span class="attr">type</span>=<span class="string">"Type2"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">type</span> <span class="attr">name</span>=<span class="string">"Type2"</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field21"</span> <span class="attr">type</span>=<span class="string">"String"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field22"</span> <span class="attr">type</span>=<span class="string">"Integer"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"*"</span>/&gt;</span>    </span><br><span class="line">                 <span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field15"</span> <span class="attr">type</span>=<span class="string">"InsuranceProduct"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">type</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">type</span> <span class="attr">name</span>=<span class="string">"Type3"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"Field31"</span> <span class="attr">type</span>=<span class="string">"Type1"</span> <span class="attr">lbound</span>=<span class="string">"1"</span> <span class="attr">ubound</span>=<span class="string">"*"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">types</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="freemaker的基本语法"><a href="#freemaker的基本语法" class="headerlink" title="freemaker的基本语法"></a>freemaker的基本语法</h3><ul>
<li>&lt;# … &gt; 中存放所有freemaker的内容，之外的内容全部原样输出。</li>
<li>&lt;@ … /&gt; 是函数调用两个定界符内的内容中，第一个符号表示指令或者函数名，其后的跟随参数。</li>
<li>freemaker提供的控制包括如下：<h2 id="freemaker的基本语法-1"><a href="#freemaker的基本语法-1" class="headerlink" title="freemaker的基本语法"></a>freemaker的基本语法</h2></li>
<li>&lt;# … &gt; 中存放所有freemaker的内容，之外的内容全部原样输出。</li>
<li>&lt;@ … /&gt; 是函数调用<br>两个定界符内的内容中，第一个符号表示指令或者函数名，其后的跟随参数。</li>
</ul>
<h4 id="freemaker语句："><a href="#freemaker语句：" class="headerlink" title="freemaker语句："></a>freemaker语句：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#if</span> <span class="attr">condition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#elseif</span> <span class="attr">condition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#else</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>条件判断</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">hash_or_seq</span> <span class="attr">as</span> <span class="attr">var</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>遍历hash表或者collection（freemaker称作sequence）的成员</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#macro</span> <span class="attr">name</span> <span class="attr">param1</span> <span class="attr">param2</span> <span class="attr">...</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#nested</span> <span class="attr">param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#macro</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 宏，无返回参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#function</span> <span class="attr">name</span> <span class="attr">param1</span> <span class="attr">param2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#return</span> <span class="attr">val</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#function</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>函数，有返回参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var?member_function(...)</span><br></pre></td></tr></table></figure>
<p> 用函数对var进行转换，freemaker称为build-ins。实际内部实现类似</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_function(var, ...)</span><br></pre></td></tr></table></figure>
<p>stringA[M .. N] 取子字符串，类似</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">substring(stringA, M, N)</span><br><span class="line">&#123;key:value, key2:value2 ...&#125;</span><br></pre></td></tr></table></figure>
<p>直接定义一个hash表</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[item0, item1, item2 ...]</span><br></pre></td></tr></table></figure>
<p> 直接定义一个序列</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash0[key0]</span><br></pre></td></tr></table></figure>
<p>存取hash表中key对应的元素</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seq0[5]</span><br></pre></td></tr></table></figure>
<p>存取序列指定下标的元素 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">@function1</span> <span class="attr">param0</span> <span class="attr">param1</span> <span class="attr">...</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>调用函数function1</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">@macro0</span> <span class="attr">param0</span> <span class="attr">param1</span> ; <span class="attr">nest_param0</span> <span class="attr">nest_param1</span> <span class="attr">...</span>&gt;</span> nest_body </span><br><span class="line"><span class="tag">&lt; /@<span class="attr">macro</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>调用宏，并处理宏的嵌套</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#assign</span> <span class="attr">var</span> = <span class="string">value</span> &gt;</span></span><br></pre></td></tr></table></figure>
<p>定义变量并初始化</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#local</span> <span class="attr">var</span> = <span class="string">value</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 macro 或者 function 中定义局部变量并初始化 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#global</span> <span class="attr">var</span> = <span class="string">value</span> &gt;</span></span><br></pre></td></tr></table></figure>
<p>定义全局变量并初始化</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;var&#125;</span><br></pre></td></tr></table></figure>
<p>输出并替换为表达式的值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#visit</span> <span class="attr">xmlnode</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>调用macro匹配xmlnode本身及其子节点</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#recurse</span> <span class="attr">xmlnode</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>调用macro匹配xmlnode的子节点</p>
<h2 id="freemaker–设计指导"><a href="#freemaker–设计指导" class="headerlink" title="freemaker–设计指导"></a>freemaker–设计指导</h2><p>一个ftl标记不能放在另外一个ftl标记里面，但是注释标记能够放在ftl标记里面。</p>
<ul>
<li>系统预定义指令采用&lt;#…&gt;&lt;/#&gt;</li>
<li>用户自定义指令采用&lt;@…&gt;&lt;/@&gt;</li>
</ul>
<p>hash片段可以采用： products[10..19] or products[5..] 的格式。</p>
<p>序列也可以做加法计算：passwords + {“joe”:”secret42”}<br>缺省值: name!”unknown” 或者 (user.name)!”unknown” 或者 name! 或者 (user.name)!<br>null值检查: name?? or (user.name)??</p>
<h3 id="转义列表："><a href="#转义列表：" class="headerlink" title="转义列表："></a>转义列表：</h3><ul>
<li style="list-style: none"><input type="checkbox" checked> Escape sequence    Meaning</li>
<li style="list-style: none"><input type="checkbox" checked> \”    Quotation mark (u0022)</li>
<li style="list-style: none"><input type="checkbox" checked> \’    Apostrophe (a.k.a. apostrophe-quote) (u0027)</li>
<li style="list-style: none"><input type="checkbox" checked> \    Back slash (u005C)</li>
<li style="list-style: none"><input type="checkbox" checked> \n    Line feed (u000A)</li>
<li style="list-style: none"><input type="checkbox" checked> \r    Carriage return (u000D)</li>
<li style="list-style: none"><input type="checkbox" checked> \t    Horizontal tabulation (a.k.a. tab) (u0009)</li>
<li style="list-style: none"><input type="checkbox" checked> \b    Backspace (u0008)</li>
<li style="list-style: none"><input type="checkbox" checked> \f    Form feed (u000C)</li>
<li style="list-style: none"><input type="checkbox" checked> \l    Less-than sign: &lt;</li>
<li style="list-style: none"><input type="checkbox" checked> \g    Greater-than sign: &gt;</li>
<li style="list-style: none"><input type="checkbox" checked> \a    Ampersand: &amp;</li>
<li style="list-style: none"><input type="checkbox" checked> {    Curly bracket: {</li>
<li style="list-style: none"><input type="checkbox" checked> \xCode    Character given with its hexadecimal Unicode code (UCS code)</li>
</ul>
<p>如果想打印${，则需要将{转义，可以写成”${user}”，或者可以用生字符（r指令）：$(r “${xx}”}</p>
<h3 id="序列构成："><a href="#序列构成：" class="headerlink" title="序列构成："></a>序列构成：</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#list</span> ["<span class="attr">winter</span>", "<span class="attr">spring</span>", "<span class="attr">summer</span>", "<span class="attr">autumn</span>"] <span class="attr">as</span> <span class="attr">x</span>&gt;</span>$&#123;x&#125;<span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>不同的对象可以存放在一个序列里面，比如：[2 + 2, [1, 2, 3, 4], “whatnot”]. 第一个是数字，第二个是序列，第三个是字符串。</p>
<p>可用采用start..end的方式来定义一个数字序列，start可以小于end，同时，end也可以省略。</p>
<p>hash取值支持一下四种模式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">book.author.name, </span><br><span class="line">book["author"].name, </span><br><span class="line">book.author.["name"], </span><br><span class="line">book["author"]["name"].</span><br></pre></td></tr></table></figure>
<p>特殊变量是指freemaker引擎本身定义的变量。访问时，以.variable_name的语法访问。</p>
<p>变量表达式支持嵌套模式，比如：${“Hello ${user}!”}。</p>
<h3 id="变量表达式在指令中的使用情况："><a href="#变量表达式在指令中的使用情况：" class="headerlink" title="变量表达式在指令中的使用情况："></a>变量表达式在指令中的使用情况：</h3><p>变量表达式可以在指令中，用“”的方式存在，不如：&lt;#include “/footer/${company}.html”&gt;.<br>但是不允许下面的方式存在： &lt;#if ${isBig}&gt;Wow!&lt;/#if&gt;</p>
<p><strong>正确写法</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if isBig&gt;Wow!&lt;/#if&gt;</span><br></pre></td></tr></table></figure></p>
<p>而且 &lt;#if “${isBig}”&gt;Wow!&lt;/#if&gt;写法也不正确，因为”${isBig}”返回的是字符串，不是boolean类型。</p>
<p>字符串中取字符或字符串采用以下语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;user[0]&#125;,$&#123;user[0..2]&#125; $&#123;user[4..]&#125;,$&#123;user?string(4)&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="序列操作："><a href="#序列操作：" class="headerlink" title="序列操作："></a>序列操作：</h3><p>   加法：&lt;#list [“Joe”, “Fred”] + [“Julia”, “Kate”] as user&gt; 但要注意串联之后的读取速度变慢。<br>   子序列：seq[1..4]</p>
<p>序列和hash的串联都只能用于两个相加，不能有多个相加的模式，hash相加，如果两个相加的hash存在相同的key，则后面会覆盖前面的。</p>
<p>在使用&gt;=或者&gt;时，需要注意一些问题，因为freemaker会将&gt;解释成标记的关闭符，为了解决这个问题，需要在表达式加上括号，比如： &lt;#if (x &gt; y)&gt;. 或者使用 &gt; and &amp;lt符号来代替。</p>
<p>无值变量（包括无该变量，null，返回void，无属性等）：unsafe_expr!default_expr or unsafe_expr! or (unsafe_expr)!default_expr or (unsafe_expr)!<br>缺省值可以是任何类型，不一定是数字，比如：hits!0 或者 colors![“red”, “green”, “blue”]. </p>
<p>如果缺省值忽略，那么将会默认为空串、空序列或者空hash，因为freemarker支持多类型的值。不过要让默认值为0或false，则不能省略缺省值。</p>
<h3 id="非顶层变量的无值处理："><a href="#非顶层变量的无值处理：" class="headerlink" title="非顶层变量的无值处理："></a>非顶层变量的无值处理：</h3><p>   product.color!”red”：只处理product不为空，color为空的缺省值处理，如果product为空，则freemaker会抛出异常。(product.color)!”red”：则会处理product为空，color为空，或者没有color属性的无值情况。</p>
<h3 id="无值变量的判断操作："><a href="#无值变量的判断操作：" class="headerlink" title="无值变量的判断操作："></a>无值变量的判断操作：</h3><p>unsafe_expr?? or (unsafe_expr)??<br>判断变量是否是无值。</p>
<h3 id="普通变量插入方式"><a href="#普通变量插入方式" class="headerlink" title="普通变量插入方式:"></a>普通变量插入方式:</h3><p>${expression},${3+5);</p>
<h3 id="数字变量插入方式"><a href="#数字变量插入方式" class="headerlink" title="数字变量插入方式:"></a>数字变量插入方式:</h3><p>#{expression} or #{expression; format}：过期。<br>变量只能用于文本区或者是字符串里面，比如：</p><h1>Hello ${name}!</h1>以及 &lt;#include “/footer/${company}.html”&gt;<p></p>
<h3 id="数字值的插入："><a href="#数字值的插入：" class="headerlink" title="数字值的插入："></a>数字值的插入：</h3><p>根据缺省的number_format输出，以及可以通过setting来达到设置数字格式的目的，也可以通过内置函数string来改变输出格式。</p>
<h3 id="日期类型的格式设置："><a href="#日期类型的格式设置：" class="headerlink" title="日期类型的格式设置："></a>日期类型的格式设置：</h3><p>date_format, time_format 和 datetime_format</p>
<h3 id="定义宏："><a href="#定义宏：" class="headerlink" title="定义宏："></a>定义宏：</h3><p>   不带参数：&lt;#macro 宏名&gt;…&lt;/#macro&gt;，引用&lt;@宏名 /&gt;<br>   带参数：&lt;#macro 宏名 参数…&gt;…&lt;/#macro&gt;，引用&lt;@宏名 参数1=值1…/&gt;，带有参数的宏，调用是参数的值必须和参数的个数相同。当然也可以在宏定义时给参数一些默认值。比如：&lt;#macro greet person color=”black”&gt;</p>
<h3 id="宏里面的嵌套内容："><a href="#宏里面的嵌套内容：" class="headerlink" title="宏里面的嵌套内容："></a>宏里面的嵌套内容：</h3><p>&lt;#macro border&gt;<br>  <table border="4" cellspacing="0" cellpadding="4"><tr><td><br>    &lt;#nested&gt;<br>  </td></tr></table><br>&lt;/#macro&gt;<br>在宏的定义body中加入&lt;#nested&gt;指令。嵌套的内容可以是任何正确的ftl块。</p>
<p>宏的本地变量在嵌套内容中是不可见的。</p>
<p>宏定义时，&lt;#nest&gt;指令相当于调用定义的内容，而使用宏时，nest body相当于定义。<br>&lt;#macro repeat count&gt;  &lt;#list 1..count as x&gt;    &lt;#nested x, x/2, x==count&gt;  &lt;/#list&gt;&lt;/#macro&gt;&lt;@repeat count=4 ; c, halfc, last&gt;  ${c}. ${halfc}&lt;#if last&gt; Last!&lt;/#if&gt;&lt;/@repeat&gt; </p>
<h3 id="定义变量："><a href="#定义变量：" class="headerlink" title="定义变量："></a>定义变量：</h3><p>   在模板中定义的变量将会隐藏（不是更改）数据模型根下面的同名的变量。</p>
<h4 id="模板中的3种类型变量："><a href="#模板中的3种类型变量：" class="headerlink" title="模板中的3种类型变量："></a>模板中的3种类型变量：</h4><ul>
<li style="list-style: none"><input type="checkbox" checked> 1：plain variables，能够在模板中的任何地方访问，一个模板include另外一个模板，也可以访问被包含模板的变量。可以通过assign或者macro指令产生或替换变量。<br> 如果要访问数据模型中的变量，则可以通过.global来访问：<br> &lt;#assign user = “Joe Hider”&gt;<br> ${user}          &lt;#– prints: Joe Hider –&gt;<br> ${.globals.user} &lt;#– prints: Big Joe–&gt; </li>
<li style="list-style: none"><input type="checkbox" checked> 2：Local variables，宏定义body中用local指令创建或者替换。</li>
<li style="list-style: none"><input type="checkbox" checked> 3：Loop variables:由list指令产生。</li>
</ul>
<p>namespaces:<br>&lt;#import “/lib/my_test.ftl” as my&gt; &lt;#– the hash called “my” will be the “gate” –&gt;<br>&lt;@my.copyright date=”1999-2002”/&gt;<br>${my.mail} </p>
<h4 id="设置命名空间里面的变量：-lt-assign-mail-”jsmith-other-com“-in-my-gt"><a href="#设置命名空间里面的变量：-lt-assign-mail-”jsmith-other-com“-in-my-gt" class="headerlink" title="设置命名空间里面的变量：&lt;#assign mail=”jsmith@other.com“ in my&gt;"></a>设置命名空间里面的变量：&lt;#assign mail=”<a href="mailto:jsmith@other.com" target="_blank" rel="noopener">jsmith@other.com</a>“ in my&gt;</h4><h4 id="命名空间与数据模型：命名空间的ftl可以访问数据模型的变量。同样命名空间的变量也会隐藏数据模型中同名的变量。"><a href="#命名空间与数据模型：命名空间的ftl可以访问数据模型的变量。同样命名空间的变量也会隐藏数据模型中同名的变量。" class="headerlink" title="命名空间与数据模型：命名空间的ftl可以访问数据模型的变量。同样命名空间的变量也会隐藏数据模型中同名的变量。"></a>命名空间与数据模型：命名空间的ftl可以访问数据模型的变量。同样命名空间的变量也会隐藏数据模型中同名的变量。</h4><h3 id="空白问题："><a href="#空白问题：" class="headerlink" title="空白问题："></a>空白问题：</h3><ul>
<li style="list-style: none"><input type="checkbox" checked> 1：White-space stripping，默认为enabled，清除ftl标记带来的空白以及缩进。处理模板的空白。</li>
<li style="list-style: none"><input type="checkbox" checked> 2：t, rt, lt指令。</li>
<li style="list-style: none"><input type="checkbox" checked> 3：ftl的参数strip_text.</li>
</ul>
<p>用compress directive或者transform来处理输出。<br>&lt;#compress&gt;…&lt;/#compress&gt;：消除空白行。<br>&lt;@compress single_line=true&gt;.../@compress将输出压缩为一行。</p>
<p>可替换语法：<br>freemarker可用”[“代替”&lt;”.在模板的文件开头加上[#ftl].</p>
<h2 id="Spring-MVC-使用-Freemarker"><a href="#Spring-MVC-使用-Freemarker" class="headerlink" title="Spring MVC 使用 Freemarker"></a>Spring MVC 使用 Freemarker</h2><p>•    Freemaker是取代JSP的又一种视图技术，和Velocity非常类似，但是它比Velocity多了一个格式化的功能，因此使用上较Velocity方便一点，但语法也稍微复杂一些。<br>将Velocity替换为Freemarker只需要改动一些配置文件，同样，在Spring中使用Freemarker也非常方便，根本无须与Freemarker的API打交道。我们将Spring_Velocity工程复制一份，命名为Spring_Freemarker</p>
<p>修改dispatcher-servlet.xml，将velocityConfig删除，修改viewResolver为FreeMarker ViewResolver，并添加一个freemarkerConfig。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用Freemarker视图解析器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view. freemarker.FreeMarkerViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"contentType"</span> <span class="attr">value</span>=<span class="string">"text/html;charset=UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".html"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Freemarker --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"freemarkerConfig"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view. freemarker.FreeMarkerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 视图资源位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"templateLoaderPath"</span> <span class="attr">value</span>=<span class="string">"/"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>模板test.html可以稍做修改，加入Freemarker内置的格式化功能来定制Date类型的输出格式。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spring_Freemarker<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Hello, $&#123;name&#125;, it is $&#123;time?string("yyyy-MM-dd HH:mm:ss")&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加freemarker.jar到web/WEB-INF/lib目录后，启动Resin，可以看到由Freemarker渲染的页面</p>
<h2 id="FreeMarker入门："><a href="#FreeMarker入门：" class="headerlink" title="FreeMarker入门："></a>FreeMarker入门：</h2><h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><h4 id="模板-数据模型-输出"><a href="#模板-数据模型-输出" class="headerlink" title="模板 + 数据模型 = 输出"></a>模板 + 数据模型 = 输出</h4><pre><code> FreeMarker基于设计者和程序员是具有不同专业技能的不同个体的观念 
他们是分工劳动的：设计者专注于表示——创建HTML文件、图片、Web页面的其它可视化方面；程序员创建系统，生成设计页面要显示的数据 
经常会遇到的问题是：在Web页面（或其它类型的文档）中显示的信息在设计页面时是无效的，是基于动态数据的 
在这里，你可以在HTML（或其它要输出的文本）中加入一些特定指令，FreeMarker会在输出页面给最终用户时，用适当的数据替代这些代码 
</code></pre><p>下面是一个例子： </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome!<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome $&#123;user&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Our latest product: </span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;latestProduct.url&#125;"</span>&gt;</span>$&#123;latestProduct.name&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>! </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个例子是在简单的HTML中加入了一些由${…}包围的特定代码，这些特定代码是FreeMarker的指令，而包含FreeMarker的指令的文件就称为模板（Template）<br>至于user、latestProduct.url和latestProduct.name来自于数据模型（data model）<br>        数据模型由程序员编程来创建，向模板提供变化的信息，这些信息来自于数据库、文件，甚至于在程序中直接生成<br>         模板设计者不关心数据从那儿来，只知道使用已经建立的数据模型<br>         下面是一个可能的数据模型： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(root) </span><br><span class="line">  | </span><br><span class="line">  +- user = &quot;Big Joe&quot; </span><br><span class="line">  | </span><br><span class="line">  +- latestProduct </span><br><span class="line">      | </span><br><span class="line">      +- url = &quot;products/greenmouse.html&quot; </span><br><span class="line">      | </span><br><span class="line">      +- name = &quot;green mouse&quot;</span><br></pre></td></tr></table></figure>
<pre><code>数据模型类似于计算机的文件系统，latestProduct可以看作是目录，而user、url和name看作是文件，url和name文件位于latestProduct目录中（这只是一个比喻，实际并不存在） 
当FreeMarker将上面的数据模型合并到模板中，就创建了下面的输出： 
</code></pre><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome!<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome Big Joe!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Our latest product: </span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"products/greenmouse.html"</span>&gt;</span>green mouse<span class="tag">&lt;/<span class="name">a</span>&gt;</span>! </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><pre><code>典型的数据模型是树型结构，可以任意复杂和深层次，如下面的例子： 
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(root) </span><br><span class="line">  | </span><br><span class="line">  +- animals </span><br><span class="line">  |   | </span><br><span class="line">  |   +- mouse </span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- size = &quot;small&quot; </span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- price = 50 </span><br><span class="line">  |   | </span><br><span class="line">  |   +- elephant </span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- size = &quot;large&quot; </span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- price = 5000 </span><br><span class="line">  |   | </span><br><span class="line">  |   +- python </span><br><span class="line">  |       |   </span><br><span class="line">  |       +- size = &quot;medium&quot; </span><br><span class="line">  |       |   </span><br><span class="line">  |       +- price = 4999 </span><br><span class="line">  | </span><br><span class="line">  +- test = &quot;It is a test&quot; </span><br><span class="line">  | </span><br><span class="line">  +- whatnot </span><br><span class="line">      | </span><br><span class="line">      +- because = &quot;don&apos;t know&quot;</span><br></pre></td></tr></table></figure>
<pre><code> 类似于目录的变量称为hashes，包含保存下级变量的唯一的查询名字 
类似于文件的变量称为scalars，保存单值 
 scalars保存的值有两种类型：字符串（用引号括起，可以是单引号或双引号）和数字（不要用引号将数字括起，这会作为字符串处理） 
对scalars的访问从root开始，各部分用“.”分隔，如animals.mouse.price 
 另外一种变量是sequences，和hashes类似，只是不使用变量名字，而使用数字索引，如下面的例子： 
</code></pre><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">(root) </span><br><span class="line">  | </span><br><span class="line">  +- animals </span><br><span class="line">  |   | </span><br><span class="line">  |   +- (1st) </span><br><span class="line">  |   |   | </span><br><span class="line">  |   |   +- name = "mouse" </span><br><span class="line">  |   |   | </span><br><span class="line">  |   |   +- size = "small" </span><br><span class="line">  |   |   | </span><br><span class="line">  |   |   +- price = 50 </span><br><span class="line">  |   | </span><br><span class="line">  |   +- (2nd) </span><br><span class="line">  |   |   | </span><br><span class="line">  |   |   +- name = "elephant" </span><br><span class="line">  |   |   | </span><br><span class="line">  |   |   +- size = "large" </span><br><span class="line">  |   |   | </span><br><span class="line">  |   |   +- price = 5000 </span><br><span class="line">  |   | </span><br><span class="line">  |   +- (3rd) </span><br><span class="line">  |       | </span><br><span class="line">  |       +- name = "python" </span><br><span class="line">  |       | </span><br><span class="line">  |       +- size = "medium" </span><br><span class="line">  |       | </span><br><span class="line">  |       +- price = 4999 </span><br><span class="line">  | </span><br><span class="line">  +- whatnot </span><br><span class="line">      | </span><br><span class="line">      +- fruits </span><br><span class="line">          | </span><br><span class="line">          +- (1st) = "orange" </span><br><span class="line">          | </span><br><span class="line">          +- (2nd) = "banana"</span><br></pre></td></tr></table></figure>
<pre><code>这种对scalars的访问使用索引，如animals[0].name 
</code></pre><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><pre><code> 在FreeMarker模板中可以包括下面三种特定部分： 
 ${…}：称为interpolations，FreeMarker会在输出时用实际值进行替代 
FTL标记（FreeMarker模板语言标记）：类似于HTML标记，为了与HTML标记区分，用#开始（有些以@开始，在后面叙述） 
注释：包含在&lt;#--和--&gt;（而不是&lt;!--和--&gt;）之间 
下面是一些使用指令的例子： 
</code></pre><h4 id="if指令"><a href="#if指令" class="headerlink" title="if指令"></a>if指令</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if animals.python.price &lt; animals.elephant.price&gt; </span><br><span class="line">  Pythons are cheaper than elephants today. </span><br><span class="line"><span class="tag">&lt;<span class="name">#else</span>&gt;</span> </span><br><span class="line">  Pythons are not cheaper than elephants today. </span><br><span class="line"><span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="list指令"><a href="#list指令" class="headerlink" title="list指令"></a>list指令</h4><p></p><p>We have these animals: </p>
<p><code></code>html</p>
<p><table border="1"><br>  <tr><th>Name</th><th>Price<br>  &lt;#list animals as being&gt;<br>  </th></tr><tr><td>${being.name}</td><td>${being.price} Euros<br>  &lt;/#list&gt;<br></td></tr></table><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">输出为： </span><br><span class="line">&lt;p&gt;We have these animals: </span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;table border=1&gt; </span><br><span class="line">  &lt;tr&gt;&lt;th&gt;Name&lt;th&gt;Price </span><br><span class="line">  &lt;tr&gt;&lt;td&gt;mouse&lt;td&gt;50 Euros </span><br><span class="line">  &lt;tr&gt;&lt;td&gt;elephant&lt;td&gt;5000 Euros </span><br><span class="line">  &lt;tr&gt;&lt;td&gt;python&lt;td&gt;4999 Euros </span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="include指令"><a href="#include指令" class="headerlink" title="include指令"></a>include指令</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Test page<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Test page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Blah blah... </span><br><span class="line"><span class="tag">&lt;<span class="name">#include</span> "/<span class="attr">copyright_footer.html</span>"&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="一起使用指令"><a href="#一起使用指令" class="headerlink" title="一起使用指令"></a>一起使用指令</h4><p></p><p>We have these animals: </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">1</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;<span class="name">th</span>&gt;</span>Price </span><br><span class="line">  <span class="tag">&lt;<span class="name">#list</span> <span class="attr">animals</span> <span class="attr">as</span> <span class="attr">being</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">#if</span> <span class="attr">being.size</span> = <span class="string">"large"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">#if</span>&gt;</span> </span><br><span class="line">      $&#123;being.name&#125; </span><br><span class="line">      <span class="tag">&lt;<span class="name">#if</span> <span class="attr">being.size</span> = <span class="string">"large"</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">#if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;being.price&#125; Euros </span><br><span class="line">  <span class="tag">&lt;/<span class="name">#list</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="常用语法"><a href="#常用语法" class="headerlink" title="常用语法"></a>常用语法</h2><p>EG.一个对象BOOK</p>
<h3 id="1-输出"><a href="#1-输出" class="headerlink" title="1.输出"></a>1.输出</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;book.name&#125;</span><br></pre></td></tr></table></figure>
<p>空值判断：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;book.name?if_exists &#125;,</span><br><span class="line">$&#123;book.name?default(‘xxx’)&#125;//默认值xxx</span><br><span class="line">$&#123; book.name!"xxx"&#125;//默认值xxx</span><br></pre></td></tr></table></figure></p>
<p>日期格式：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;book.date?string('yyyy-MM-dd')&#125;</span><br></pre></td></tr></table></figure></p>
<p>数字格式：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;book?string.number&#125;--20</span><br><span class="line">$&#123;book?string.currency&#125;--<span class="tag">&lt;<span class="name">#--</span> $<span class="attr">20.00</span> <span class="attr">--</span>&gt;</span></span><br><span class="line">$&#123;book?string.percent&#125;—<span class="tag">&lt;<span class="name">#--</span> <span class="attr">20</span>% <span class="attr">--</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>插入布尔值：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#assign</span> <span class="attr">foo</span>=<span class="string">ture</span> /&gt;</span></span><br><span class="line">$&#123;foo?string("yes","no")&#125; <span class="tag">&lt;<span class="name">#--</span> <span class="attr">yes</span> <span class="attr">--</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2．逻辑判断"><a href="#2．逻辑判断" class="headerlink" title="2．逻辑判断"></a>2．逻辑判断</h3><p>a:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#if</span> <span class="attr">condition</span>&gt;</span>...</span><br><span class="line"><span class="tag">&lt;<span class="name">#elseif</span> <span class="attr">condition2</span>&gt;</span>...</span><br><span class="line"><span class="tag">&lt;<span class="name">#elseif</span> <span class="attr">condition3</span>&gt;</span>......</span><br><span class="line"><span class="tag">&lt;<span class="name">#else</span>&gt;</span>...</span><br></pre></td></tr></table></figure>
<p>其中空值判断可以写成<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#if</span> <span class="attr">book.name</span>?? &gt;</span></span><br></pre></td></tr></table></figure></p>
<p>b:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#switch</span> <span class="attr">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#case</span> <span class="attr">refValue1</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">#break</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#case</span> <span class="attr">refValue2</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">#break</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">#case</span> <span class="attr">refValueN</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">#break</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#default</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="3．循环读取"><a href="#3．循环读取" class="headerlink" title="3．循环读取"></a>3．循环读取</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">sequence</span> <span class="attr">as</span> <span class="attr">item</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="空值判断"><a href="#空值判断" class="headerlink" title="空值判断"></a>空值判断</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#if</span> <span class="attr">bookList</span>?<span class="attr">size</span> = <span class="string">0</span>&gt;</span></span><br><span class="line">e.g.</span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">employees</span> <span class="attr">as</span> <span class="attr">e</span>&gt;</span></span><br><span class="line">$&#123;e_index&#125;. $&#123;e.name&#125;</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Readonly</span><br><span class="line">2. Robbin</span><br></pre></td></tr></table></figure>
<p>freemarker中Map的使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">testMap</span>?<span class="attr">keys</span> <span class="attr">as</span> <span class="attr">testKey</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt; <span class="attr">option</span> <span class="attr">value</span>=<span class="string">"$&#123;testKey&#125;"</span> &gt;</span> </span><br><span class="line">              $&#123;testMap[testKey]&#125; </span><br><span class="line">     <span class="tag">&lt;/<span class="name">option</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="解析FreeMarker视图"><a href="#解析FreeMarker视图" class="headerlink" title="解析FreeMarker视图"></a>解析FreeMarker视图</h2><p>声明一个针对FreeMarker的视图解析器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.</span></span></span><br><span class="line"><span class="tag"><span class="string">          ➥web.servlet.view.freemarker.FreeMarkerViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>.ftl<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>FreeMarkerViewResolver和VelocityViewResolver或InternalResourceViewResolver的工作机制相同。模板资源是通过在视图的逻辑名上增加prefix属性的值作为前缀，以及增加suffix属性的值作为后缀进行解析的。和VelocityViewResolver一样，在这里我们又一次只设置suffix属性，因为模板的路径已经在FreeMarkerConfigurer的templateLoaderPath属性中定义了。<br>暴露请求和会话属性。你看到如何告诉VelocityViewResolver将请求和会话属性复制到模型map中，从而它们能够在模板中作为变量使用。采用同样的方式配置FreeMarkerViewResolver，可以将请求和会话属性作为变量暴露给FreeMarker模板使用。要做到这一点，可以设置exposeRequestAttributes或者exposeSessionAttributes为true：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.</span></span></span><br><span class="line"><span class="tag"><span class="string">          web.servlet.view.freemarker.FreeMarkerViewResolver"</span>&gt;</span></span><br><span class="line">  …</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exposeRequestAttributes"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exposeSessionAttributes"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里，两个属性都被设置为true。结果是请求和会话属性都被复制到模板的属性集中，可以使用FreeMarker的表达式语言来访问并显示。</p>
<h2 id="数据源-freemarker-servlet生成xml文件"><a href="#数据源-freemarker-servlet生成xml文件" class="headerlink" title="数据源+freemarker+servlet生成xml文件"></a>数据源+freemarker+servlet生成xml文件</h2><h3 id="一-步骤"><a href="#一-步骤" class="headerlink" title="一.步骤:"></a>一.步骤:</h3><h4 id="1-在server-xml文件中建立数据源"><a href="#1-在server-xml文件中建立数据源" class="headerlink" title="1.在server.xml文件中建立数据源."></a>1.在server.xml文件中建立数据源.</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Cms"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">enableLookups</span>=<span class="string">"false"</span> <span class="attr">port</span>=<span class="string">"8084"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">acceptCount</span>=<span class="string">"100"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">disableUploadTimeout</span>=<span class="string">"true"</span> </span></span><br><span class="line"><span class="tag"> </span></span><br><span class="line"><span class="tag"> <span class="attr">enableLookups</span>=<span class="string">"false"</span> <span class="attr">maxSpareThreads</span>=<span class="string">"75"</span> <span class="attr">maxThreads</span>=<span class="string">"150"</span> <span class="attr">minSpareThreads</span>=<span class="string">"25"</span> <span class="attr">port</span>=<span class="string">"8081"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">Engine</span> <span class="attr">defaultHost</span>=<span class="string">"localhost_Cms"</span> <span class="attr">name</span>=<span class="string">"Catalina_Cms"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.logger.FileLogger"</span> <span class="attr">prefix</span>=<span class="string">"localhost_cmt_log."</span> <span class="attr">suffix</span>=<span class="string">".txt"</span> <span class="attr">timestamp</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.UserDatabaseRealm"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">Host</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">name</span>=<span class="string">"localhost_Cms"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">xmlNamespaceAware</span>=<span class="string">"false"</span> <span class="attr">xmlValidation</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">Context</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">docBase</span>=<span class="string">"D:WorkspaceCMSweb"</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> <span class="attr">workDir</span>=<span class="string">"D:WorkspaceCMSj2src"</span>&gt;</span> </span><br><span class="line">           <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"jdbc/news_DB"</span> <span class="attr">auth</span>=<span class="string">"Container"</span> <span class="attr">type</span>=<span class="string">"javax.sql.DataSource"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">ResourceParams</span> <span class="attr">name</span>=<span class="string">"jdbc/news_DB"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>factory<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- DBCP Basic Datasource Factory --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.commons.dbcp.BasicDataSourceFactory<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>maxActive<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>validationQuery<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>select 1+1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>maxIdle<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>maxWait<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>removeAbandoned<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>removeAbandonedTimeout<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>60<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>logAbandoned<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>username<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>aaaa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>password<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bbbbbb<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>driverClassName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>net.sourceforge.jtds.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>url<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:jtds:sqlserver://111.111.111.111:1433/cms<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">ResourceParams</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-在web-xml文件中配置servlet"><a href="#2-在web-xml文件中配置servlet" class="headerlink" title="2.在web.xml文件中配置servlet"></a>2.在web.xml文件中配置servlet</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">description</span>&gt;</span>generate xml file<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>NewsXmlServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>xml.NewsXmlServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>NewsXmlServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/xmlServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-newsXmlServlet-java"><a href="#3-newsXmlServlet-java" class="headerlink" title="3.newsXmlServlet.java"></a>3.newsXmlServlet.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xml;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> java.io.*;</span><br><span class="line"> <span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"> <span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"> <span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"> <span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"> <span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"> <span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"> <span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"> <span class="keyword">import</span> java.util.List;</span><br><span class="line"> <span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"> <span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"> <span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"> <span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"> <span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> freemarker.template.Configuration;</span><br><span class="line"> <span class="keyword">import</span> freemarker.template.Template;</span><br><span class="line"> <span class="keyword">import</span> freemarker.template.TemplateException;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> java.util.Locale;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsXmlServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">              <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">         <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">             Connection conn=<span class="keyword">null</span>;</span><br><span class="line">             Context ctx = <span class="keyword">new</span> InitialContext();</span><br><span class="line">             DataSource ds=(DataSource)ctx.lookup(<span class="string">"java:comp/env/jdbc/news_DB"</span>);</span><br><span class="line">             conn=ds.getConnection();</span><br><span class="line">             Statement stmt=conn.createStatement();</span><br><span class="line">             ResultSet rs=stmt.executeQuery(<span class="string">"select url,updatetime,tpf_edu_contentTitle,tpf_edu_contentneirong,tpf_edu_contentlaiyuan,tpf_edu_contentkeyword from tp5__edu_content where url&lt;&gt;'' and url is not null and dateDiff(d,updatetime,getDate())=1 order by updatetime desc"</span>);</span><br><span class="line">             Configuration cfg=<span class="keyword">new</span> Configuration();</span><br><span class="line">             cfg.setDirectoryForTemplateLoading(<span class="keyword">new</span> File(<span class="string">"E:/wwwroot/CMS/web/WEB-INF/classes/xml"</span>));</span><br><span class="line">             Template tem=cfg.getTemplate(<span class="string">"news.ftl"</span>);</span><br><span class="line">             </span><br><span class="line">             List list=<span class="keyword">new</span> ArrayList();</span><br><span class="line">             OutputStreamWriter out=<span class="keyword">new</span> OutputStreamWriter(System.out);</span><br><span class="line">              <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                 Map item=<span class="keyword">new</span> HashMap();</span><br><span class="line">                 item.put(<span class="string">"title"</span>,rs.getString(<span class="number">3</span>));</span><br><span class="line">                 item.put(<span class="string">"link"</span>,<span class="string">"http://test.com.cn"</span>+rs.getString(<span class="number">1</span>));</span><br><span class="line">                 item.put(<span class="string">"pubdate"</span>,rs.getTimestamp(<span class="number">2</span>));</span><br><span class="line">                 item.put(<span class="string">"content"</span>,DelHtml(rs.getString(<span class="number">4</span>)));</span><br><span class="line">                 item.put(<span class="string">"source"</span>,rs.getString(<span class="number">5</span>));</span><br><span class="line">                 item.put(<span class="string">"keywords"</span>,DelHtml(rs.getString(<span class="number">6</span>)));</span><br><span class="line">                 list.add(item);</span><br><span class="line">             &#125;</span><br><span class="line">             Map data=<span class="keyword">new</span> HashMap();</span><br><span class="line">             data.put(<span class="string">"items"</span>,list);</span><br><span class="line">             StringWriter writer=<span class="keyword">new</span> StringWriter();</span><br><span class="line">             tem.process(data,writer);</span><br><span class="line">             String content=writer.toString();</span><br><span class="line">             writer.close();</span><br><span class="line">             createXml(content);</span><br><span class="line">             out.close();</span><br><span class="line">             <span class="comment">//resp.setContentType("text/xml; charset=utf-8");</span></span><br><span class="line">             <span class="comment">//resp.getWriter().write(content);</span></span><br><span class="line">             </span><br><span class="line">          &#125; <span class="keyword">catch</span> (NamingException e) &#123;</span><br><span class="line">             <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">             e.printStackTrace();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">             e.printStackTrace();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (TemplateException e) &#123;</span><br><span class="line">             <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">             e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line">     &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">DelHtml</span><span class="params">(String content)</span></span>&#123;</span><br><span class="line">         String contents=content.replaceAll(<span class="string">"&lt;\/?\s*(\S+)(\s*[^&gt;]*)?\s*\/?&gt;"</span>,<span class="string">""</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;ldquo;"</span>, <span class="string">"”"</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;rdquo;"</span>,<span class="string">"”"</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;ldquo;"</span>, <span class="string">"‘"</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;rdquo;"</span>,<span class="string">"’"</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;middot;"</span>,<span class="string">"•"</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;mdash;"</span>,<span class="string">"—"</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;hellip;"</span>,<span class="string">"…"</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">"&amp;nbsp;"</span>,<span class="string">""</span>);</span><br><span class="line">          contents=contents.replaceAll(<span class="string">","</span>,<span class="string">" "</span>);</span><br><span class="line">         <span class="keyword">return</span> contents;        </span><br><span class="line">     &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createXml</span><span class="params">(String fileContent)</span></span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">             String filePath=<span class="string">"E:/wwwroot/cmsHtml/education/news.xml"</span>;</span><br><span class="line">             File fileXml=<span class="keyword">new</span> File(filePath);</span><br><span class="line">              <span class="keyword">if</span>(!fileXml.exists())&#123;            </span><br><span class="line">                 fileXml.createNewFile();</span><br><span class="line">             &#125;</span><br><span class="line">             </span><br><span class="line">              <span class="comment">/*FileWriter fileWriter=new FileWriter(fileXml);</span></span><br><span class="line"><span class="comment">             fileWriter.</span></span><br><span class="line"><span class="comment">             fileWriter.write(fileContent);</span></span><br><span class="line"><span class="comment">             fileWriter.close();*/</span></span><br><span class="line">                 OutputStreamWriter writer=<span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(fileXml), Charset.forName(<span class="string">"utf-8"</span>));     </span><br><span class="line">                 writer.write(fileContent);</span><br><span class="line">                 writer.close();</span><br><span class="line">              &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                 <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                 e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">         <span class="keyword">super</span>.destroy();</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">         <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">         <span class="keyword">super</span>.init();</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-news-ftl"><a href="#4-news-ftl" class="headerlink" title="4.news.ftl"></a>4.news.ftl</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span><br><span class="line"> <span class="tag">&lt;<span class="name">document</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">webSite</span>&gt;</span>edu.aweb.com.cn<span class="tag">&lt;/<span class="name">webSite</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">webMaster</span>&gt;</span>webmaster@aweb.com.cn<span class="tag">&lt;/<span class="name">webMaster</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">updatePeri</span>&gt;</span>1440<span class="tag">&lt;/<span class="name">updatePeri</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">#list</span> <span class="attr">items</span> <span class="attr">as</span> <span class="attr">it</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;![CDATA[$&#123;it.title&#125;]]&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">link</span>&gt;</span>$&#123;it.link&#125;<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">pubDate</span>&gt;</span>$&#123;it.pubdate&#125;<span class="tag">&lt;/<span class="name">pubDate</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">text</span>&gt;</span>&lt;![CDATA[$&#123;it.content&#125;]]&gt;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">image</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;it.source&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">keywords</span>&gt;</span>&lt;![CDATA[$&#123;it.keywords&#125;]]&gt;<span class="tag">&lt;/<span class="name">keywords</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">document</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Spring中使用FreeMaker或Vilocity模板发送邮件"><a href="#Spring中使用FreeMaker或Vilocity模板发送邮件" class="headerlink" title="Spring中使用FreeMaker或Vilocity模板发送邮件"></a>Spring中使用FreeMaker或Vilocity模板发送邮件</h2><p> 本文以用户注册后为用户发送一封邮件为例子，讲述如何在Spring中使用FreeMaker或Vilocity发送邮件。</p>
<h3 id="Spring配置文件："><a href="#Spring配置文件：" class="headerlink" title="Spring配置文件："></a>Spring配置文件：</h3><p>xml 代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mailSender"</span> <span class="attr">class</span>=<span class="string">"org.springframework.mail.javamail.JavaMailSenderImpl"</span>&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"host"</span> <span class="attr">value</span>=<span class="string">"smtp.163.com"</span>/&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"test"</span>/&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"javaMailProperties"</span>&gt;</span>   </span><br><span class="line"> 	              <span class="tag">&lt;<span class="name">props</span>&gt;</span>   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"mail.smtp.auth"</span>&gt;</span>trueprop&gt;   </span><br><span class="line"> 	              props&gt;   </span><br><span class="line"> 	        property&gt;   </span><br><span class="line"> 	    bean&gt;   </span><br><span class="line"> 	   </span><br><span class="line"> 	       </span><br><span class="line"> 	    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"freeMarkerConfigurer"</span>                    <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"</span>&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"templateLoaderPath"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/freemakertemplate/"</span> /&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"freemarkerSettings"</span>&gt;</span>   </span><br><span class="line"> 	            <span class="tag">&lt;<span class="name">props</span>&gt;</span>   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"template_update_delay"</span>&gt;</span>0prop&gt;   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"default_encoding"</span>&gt;</span>GBKprop&gt;   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"locale"</span>&gt;</span>zh_CNprop&gt;   </span><br><span class="line"> 	            props&gt;   </span><br><span class="line"> 	        property&gt;   </span><br><span class="line"> 	    bean&gt;   </span><br><span class="line"> 	        </span><br><span class="line"> 	       </span><br><span class="line"> 	    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"velocityEngine"</span> <span class="attr">class</span>=<span class="string">"org.springframework.ui.velocity.VelocityEngineFactoryBean"</span>&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"resourceLoaderPath"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/vilocitytemplate/"</span> /&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"velocityProperties"</span>&gt;</span>   </span><br><span class="line"> 	            <span class="tag">&lt;<span class="name">props</span>&gt;</span>   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"velocimacro.library"</span>&gt;</span>*.vmprop&gt;   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"default.contentType"</span>&gt;</span>text/html; charset=utf-8prop&gt;   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"output.encoding"</span>&gt;</span>utf-8prop&gt;   </span><br><span class="line"> 	                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"input.encoding"</span>&gt;</span>utf-8prop&gt;   </span><br><span class="line"> 	            props&gt;   </span><br><span class="line"> 	        property&gt;   </span><br><span class="line"> 	    bean&gt;   </span><br><span class="line"> 	        </span><br><span class="line"> 	     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mailMessage"</span> <span class="attr">class</span>=<span class="string">"org.springframework.mail.SimpleMailMessage"</span> <span class="attr">singleton</span>=<span class="string">"false"</span>&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"from"</span> <span class="attr">value</span>=<span class="string">"test@163.com"</span>/&gt;</span>   </span><br><span class="line"> 	    bean&gt;   </span><br><span class="line"> 	        </span><br><span class="line"> 	    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mailEngine"</span> <span class="attr">class</span>=<span class="string">"test.MailEngine"</span>&gt;</span>   </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mailSender"</span> <span class="attr">ref</span>=<span class="string">"mailSender"</span>/&gt;</span>   </span><br><span class="line"> 	           </span><br><span class="line"> 	        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"velocityEngine"</span> <span class="attr">ref</span>=<span class="string">"velocityEngine"</span>/&gt;</span>   </span><br><span class="line"> 	          </span><br><span class="line"> 	       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"freeMarkerConfigurer"</span> <span class="attr">ref</span>=<span class="string">"freeMarkerConfigurer"</span> /&gt;</span>   </span><br><span class="line"> 	    bean&gt;</span><br></pre></td></tr></table></figure>
<p>java 代码<br>MailEngine类：    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailEngine</span> </span>&#123;    </span><br><span class="line">	    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> Log log = LogFactory.getLog(MailEngine.class);    </span><br><span class="line">	   </span><br><span class="line">	<span class="comment">//    private FreeMarkerConfigurer freeMarkerConfigurer;    </span></span><br><span class="line">	    <span class="keyword">private</span> VelocityEngine velocityEngine;    </span><br><span class="line">	    <span class="keyword">private</span> MailSender mailSender;    </span><br><span class="line">	   </span><br><span class="line">	<span class="comment">//    public void setFreeMarkerConfigurer(    </span></span><br><span class="line">	<span class="comment">//            FreeMarkerConfigurer freeMarkerConfigurer) &#123;    </span></span><br><span class="line">	<span class="comment">//        this.freeMarkerConfigurer = freeMarkerConfigurer;    </span></span><br><span class="line">	<span class="comment">//    &#125;    </span></span><br><span class="line">	   </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMailSender</span><span class="params">(MailSender mailSender)</span> </span>&#123;    </span><br><span class="line">	        <span class="keyword">this</span>.mailSender = mailSender;    </span><br><span class="line">	    &#125;    </span><br><span class="line">	   </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVelocityEngine</span><span class="params">(VelocityEngine velocityEngine)</span> </span>&#123;    </span><br><span class="line">	        <span class="keyword">this</span>.velocityEngine = velocityEngine;    </span><br><span class="line">	    &#125;    </span><br><span class="line">	   </span><br><span class="line">	    <span class="comment">/**   </span></span><br><span class="line"><span class="comment">	     * 通过模板产生邮件正文   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> templateName    邮件模板名称   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> map            模板中要填充的对象   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@return</span> 邮件正文（HTML）   </span></span><br><span class="line"><span class="comment">	     */</span>   </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> String <span class="title">generateEmailContent</span><span class="params">(String templateName, Map map)</span> </span>&#123;    </span><br><span class="line">	        <span class="comment">//使用FreeMaker模板    </span></span><br><span class="line">	<span class="comment">//        try &#123;    </span></span><br><span class="line">	<span class="comment">//            Configuration configuration = freeMarkerConfigurer.getConfiguration();    </span></span><br><span class="line">	<span class="comment">//            Template t = configuration.getTemplate(templateName);    </span></span><br><span class="line">	<span class="comment">//            return FreeMarkerTemplateUtils.processTemplateIntoString(t, map);    </span></span><br><span class="line">	<span class="comment">//        &#125; catch (TemplateException e) &#123;    </span></span><br><span class="line">	<span class="comment">//            log.error("Error while processing FreeMarker template ", e);    </span></span><br><span class="line">	<span class="comment">//        &#125; catch (FileNotFoundException e) &#123;    </span></span><br><span class="line">	<span class="comment">//            e.printStackTrace();    </span></span><br><span class="line">	<span class="comment">//            //log.error("Error while open template file ", e);    </span></span><br><span class="line">	<span class="comment">//        &#125; catch (IOException e) &#123;    </span></span><br><span class="line">	<span class="comment">//            log.error("Error while generate Email Content ", e);    </span></span><br><span class="line">	<span class="comment">//        &#125;    </span></span><br><span class="line">	            </span><br><span class="line">	<span class="comment">//        使用Vilocity模板    </span></span><br><span class="line">	        <span class="keyword">try</span> &#123;    </span><br><span class="line">	           <span class="keyword">return</span> VelocityEngineUtils.mergeTemplateIntoString(velocityEngine, templateName, map);    </span><br><span class="line">	        &#125; <span class="keyword">catch</span> (VelocityException e) &#123;    </span><br><span class="line">	            log.error(<span class="string">"Error while processing Vilocity template "</span>, e);    </span><br><span class="line">	        &#125;    </span><br><span class="line">	            </span><br><span class="line">	        <span class="keyword">return</span> <span class="keyword">null</span>;    </span><br><span class="line">	    &#125;    </span><br><span class="line">	   </span><br><span class="line">	    <span class="comment">/**   </span></span><br><span class="line"><span class="comment">	     * 发送邮件   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> emailAddress        收件人Email地址的数组   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> fromEmail            寄件人Email地址, null为默认寄件人web@vnvtrip.com   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> bodyText            邮件正文   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> subject            邮件主题   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> attachmentName    附件名   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> resource            附件   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@throws</span> MessagingException   </span></span><br><span class="line"><span class="comment">	     */</span>   </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String[] emailAddresses, String fromEmail,    </span></span></span><br><span class="line"><span class="function"><span class="params">	            String bodyText, String subject, String attachmentName,    </span></span></span><br><span class="line"><span class="function"><span class="params">	            ClassPathResource resource)</span> <span class="keyword">throws</span> MessagingException </span>&#123;    </span><br><span class="line">	        MimeMessage message = ((JavaMailSenderImpl) mailSender)    </span><br><span class="line">	                .createMimeMessage();    </span><br><span class="line">	   </span><br><span class="line">	        <span class="comment">// use the true flag to indicate you need a multipart message    </span></span><br><span class="line">	        MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>);    </span><br><span class="line">	   </span><br><span class="line">	        helper.setTo(emailAddresses);    </span><br><span class="line">	        <span class="keyword">if</span>(fromEmail != <span class="keyword">null</span>)&#123;    </span><br><span class="line">	            helper.setFrom(fromEmail);    </span><br><span class="line">	        &#125;    </span><br><span class="line">	        helper.setText(bodyText, <span class="keyword">true</span>);    </span><br><span class="line">	        helper.setSubject(subject);    </span><br><span class="line">	            </span><br><span class="line">	        <span class="keyword">if</span>(attachmentName!=<span class="keyword">null</span> &amp;&amp; resource!=<span class="keyword">null</span>)    </span><br><span class="line">	            helper.addAttachment(attachmentName, resource);    </span><br><span class="line">	   </span><br><span class="line">	        ((JavaMailSenderImpl) mailSender).send(message);    </span><br><span class="line">	    &#125;    </span><br><span class="line">	   </span><br><span class="line">	    <span class="comment">/**   </span></span><br><span class="line"><span class="comment">	     * 发送简单邮件   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> msg       </span></span><br><span class="line"><span class="comment">	     */</span>   </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(SimpleMailMessage msg)</span> </span>&#123;    </span><br><span class="line">	        <span class="keyword">try</span> &#123;    </span><br><span class="line">	            ((JavaMailSenderImpl) mailSender).send(msg);    </span><br><span class="line">	        &#125; <span class="keyword">catch</span> (MailException ex) &#123;    </span><br><span class="line">	            <span class="comment">//log it and go on    </span></span><br><span class="line">	            log.error(ex.getMessage());    </span><br><span class="line">	        &#125;    </span><br><span class="line">	    &#125;    </span><br><span class="line">	        </span><br><span class="line">	    <span class="comment">/**   </span></span><br><span class="line"><span class="comment">	     * 使用模版发送HTML格式的邮件   </span></span><br><span class="line"><span class="comment">	     *   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> msg          装有to,from,subject信息的SimpleMailMessage   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> templateName 模版名,模版根路径已在配置文件定义于freemakarengine中   </span></span><br><span class="line"><span class="comment">	     * <span class="doctag">@param</span> model        渲染模版所需的数据   </span></span><br><span class="line"><span class="comment">	     */</span>   </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(SimpleMailMessage msg, String templateName, Map model)</span> </span>&#123;    </span><br><span class="line">	        <span class="comment">//生成html邮件内容    </span></span><br><span class="line">	        String content = generateEmailContent(templateName, model);    </span><br><span class="line">	        MimeMessage mimeMsg = <span class="keyword">null</span>;    </span><br><span class="line">	        <span class="keyword">try</span> &#123;    </span><br><span class="line">	            mimeMsg = ((JavaMailSenderImpl) mailSender).createMimeMessage();    </span><br><span class="line">	            MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMsg, <span class="keyword">true</span>, <span class="string">"utf-8"</span>);    </span><br><span class="line">	            helper.setTo(msg.getTo());    </span><br><span class="line">	                </span><br><span class="line">	            <span class="keyword">if</span>(msg.getSubject()!=<span class="keyword">null</span>)    </span><br><span class="line">	                helper.setSubject(msg.getSubject());    </span><br><span class="line">	                </span><br><span class="line">	            <span class="keyword">if</span>(msg.getFrom()!=<span class="keyword">null</span>)    </span><br><span class="line">	                helper.setFrom(msg.getFrom());    </span><br><span class="line">	                </span><br><span class="line">	            helper.setText(content, <span class="keyword">true</span>);    </span><br><span class="line">	                </span><br><span class="line">	            ((JavaMailSenderImpl) mailSender).send(mimeMsg);    </span><br><span class="line">	        &#125; <span class="keyword">catch</span> (MessagingException ex) &#123;    </span><br><span class="line">	            log.error(ex.getMessage(), ex);    </span><br><span class="line">	        &#125;    </span><br><span class="line">	   </span><br><span class="line">	    &#125;    </span><br><span class="line">	&#125;    </span><br><span class="line">	   </span><br><span class="line">	<span class="comment">//发送邮件：    </span></span><br><span class="line">	SimpleMailMessage message = (SimpleMailMessage) getBean(<span class="string">"mailMessage"</span>);    </span><br><span class="line">	                message.setTo(user.getName() + <span class="string">"&lt;"</span> + user.getEmail() + <span class="string">"&gt;"</span>);    </span><br><span class="line">	                    </span><br><span class="line">	                Map model = <span class="keyword">new</span> HashMap();    </span><br><span class="line">	                model.put(<span class="string">"user"</span>, user);    </span><br><span class="line">	                    </span><br><span class="line">	                MailEngine engine = (MailEngine)getBean(<span class="string">"mailEngine"</span>);    </span><br><span class="line">	                <span class="comment">//Vilocity模板    </span></span><br><span class="line">	                engine.send(message, <span class="string">"notifyUser.vm"</span>, model);    </span><br><span class="line">	                <span class="comment">//FreeMaker模板    </span></span><br><span class="line">	                <span class="comment">//engine.send(message, "NotifyUser.ftl", model);</span></span><br></pre></td></tr></table></figure>
<p>以上的User为用户类。   </p>
<p>xml 代码<br>模板：    </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=UTF-8"</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>用户注册通知title&gt;   </span><br><span class="line">head&gt;   </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>$&#123;user.name&#125; 您好，恭喜您，已经成为本站会员！p&gt;   </span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名：td&gt;<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;user.name&#125;td&gt;tr&gt;   </span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>密码：td&gt;<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;user.password&#125;td&gt;tr&gt;   </span><br><span class="line">table&gt;   </span><br><span class="line">body&gt;   </span><br><span class="line">html&gt;</span><br></pre></td></tr></table></figure>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Freemaker" >
    <span class="tag-code">Freemaker</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/blog/44114.html">
        <span class="nav-arrow">← </span>
        
          三目运算详解
        
      </a>
    
    
      <a class="nav-right" href="/blog/63673.html">
        
          CMS源码解读
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#freemaker的基本语法"><span class="toc-nav-text">freemaker的基本语法</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#freemaker的基本语法-1"><span class="toc-nav-text">freemaker的基本语法</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#freemaker语句："><span class="toc-nav-text">freemaker语句：</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#freemaker–设计指导"><span class="toc-nav-text">freemaker–设计指导</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#转义列表："><span class="toc-nav-text">转义列表：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#序列构成："><span class="toc-nav-text">序列构成：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#变量表达式在指令中的使用情况："><span class="toc-nav-text">变量表达式在指令中的使用情况：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#序列操作："><span class="toc-nav-text">序列操作：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#非顶层变量的无值处理："><span class="toc-nav-text">非顶层变量的无值处理：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#无值变量的判断操作："><span class="toc-nav-text">无值变量的判断操作：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#普通变量插入方式"><span class="toc-nav-text">普通变量插入方式:</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#数字变量插入方式"><span class="toc-nav-text">数字变量插入方式:</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-text">Hello ${name}!</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#数字值的插入："><span class="toc-nav-text">数字值的插入：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#日期类型的格式设置："><span class="toc-nav-text">日期类型的格式设置：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#定义宏："><span class="toc-nav-text">定义宏：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#宏里面的嵌套内容："><span class="toc-nav-text">宏里面的嵌套内容：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#定义变量："><span class="toc-nav-text">定义变量：</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#模板中的3种类型变量："><span class="toc-nav-text">模板中的3种类型变量：</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#设置命名空间里面的变量：-lt-assign-mail-”jsmith-other-com“-in-my-gt"><span class="toc-nav-text">设置命名空间里面的变量：&lt;#assign mail=”jsmith@other.com“ in my&gt;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#命名空间与数据模型：命名空间的ftl可以访问数据模型的变量。同样命名空间的变量也会隐藏数据模型中同名的变量。"><span class="toc-nav-text">命名空间与数据模型：命名空间的ftl可以访问数据模型的变量。同样命名空间的变量也会隐藏数据模型中同名的变量。</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#空白问题："><span class="toc-nav-text">空白问题：</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Spring-MVC-使用-Freemarker"><span class="toc-nav-text">Spring MVC 使用 Freemarker</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#FreeMarker入门："><span class="toc-nav-text">FreeMarker入门：</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#快速入门"><span class="toc-nav-text">快速入门</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#模板-数据模型-输出"><span class="toc-nav-text">模板 + 数据模型 = 输出</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#数据模型"><span class="toc-nav-text">数据模型</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#模板"><span class="toc-nav-text">模板</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#if指令"><span class="toc-nav-text">if指令</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#list指令"><span class="toc-nav-text">list指令</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#include指令"><span class="toc-nav-text">include指令</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#一起使用指令"><span class="toc-nav-text">一起使用指令</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#常用语法"><span class="toc-nav-text">常用语法</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-输出"><span class="toc-nav-text">1.输出</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2．逻辑判断"><span class="toc-nav-text">2．逻辑判断</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3．循环读取"><span class="toc-nav-text">3．循环读取</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#空值判断"><span class="toc-nav-text">空值判断</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#解析FreeMarker视图"><span class="toc-nav-text">解析FreeMarker视图</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#数据源-freemarker-servlet生成xml文件"><span class="toc-nav-text">数据源+freemarker+servlet生成xml文件</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#一-步骤"><span class="toc-nav-text">一.步骤:</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-在server-xml文件中建立数据源"><span class="toc-nav-text">1.在server.xml文件中建立数据源.</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-在web-xml文件中配置servlet"><span class="toc-nav-text">2.在web.xml文件中配置servlet</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-newsXmlServlet-java"><span class="toc-nav-text">3.newsXmlServlet.java</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-news-ftl"><span class="toc-nav-text">4.news.ftl</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Spring中使用FreeMaker或Vilocity模板发送邮件"><span class="toc-nav-text">Spring中使用FreeMaker或Vilocity模板发送邮件</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Spring配置文件："><span class="toc-nav-text">Spring配置文件：</span></a></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://m.iskei.cn/blog/39074.html';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "imcco";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "Freemaker开发学习笔记",
        owner: "imcco",
        repo: "m.github.io",
        oauth: {
          client_id: "ee7ec372a862879e3f2c",
          client_secret: "00a58ccb1a0555f87a87dc3a1b779ee8d12ded80"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2018 | Proudly powered by <a href="https://vuejs.io" target="_blank">vueJs</a>
    <br>
    Theme by <a href="https://github.com/imcco">Imcco</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>

  </body>
</html>